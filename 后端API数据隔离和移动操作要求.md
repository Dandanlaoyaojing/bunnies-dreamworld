# 后端API数据隔离和移动操作要求

## 一、数据隔离要求

### 1.1 三个独立的数据存储空间

后端需要确保以下API接口返回的数据是完全隔离的：

#### 常规笔记（笔记簿）
- **接口**: `GET /api/v1/notes`
- **要求**: 只返回活跃的常规笔记
- **必须排除**:
  - `status === 'deleted'` 的笔记
  - `isDeleted === true` 的笔记
  - `isDraft === true` 的笔记
  - `status === 'draft'` 的笔记
- **用途**: 这是笔记簿、知识星图、梦之国度等应用的唯一数据源

#### 草稿箱
- **接口**: `GET /api/v1/drafts`
- **要求**: 只返回草稿数据
- **存储**: 应该存储在独立的 `drafts` 表或集合中
- **用途**: 只用于草稿箱功能

#### 回收站
- **接口**: `GET /api/v1/notes/trash/list`
- **要求**: 只返回已删除的笔记
- **存储**: 可以存储在独立的 `trash` 表，或通过 `status === 'deleted'` 标记
- **用途**: 只用于回收站功能

### 1.2 数据隔离验证

后端API应该确保：
- `/notes` 接口返回的数据中，**不包含**草稿和已删除笔记
- `/drafts` 接口返回的数据中，**不包含**常规笔记和已删除笔记
- `/notes/trash/list` 接口返回的数据中，**不包含**常规笔记和草稿

## 二、移动操作要求（移动而非复制）

### 2.1 删除笔记 → 移到回收站

**接口**: `DELETE /api/v1/notes/{id}`

**要求**:
1. 从常规笔记列表（`notes` 表）中**移除**该笔记
2. 将笔记**添加**到回收站（`trash` 表或标记 `status = 'deleted'`）
3. **不允许**在常规笔记列表中保留该笔记

**期望行为**:
```javascript
// 调用 DELETE /api/v1/notes/123
// 结果：
// - notes表中不再有id=123的记录
// - trash表中有了id=123的记录（或notes表中该记录的status变为'deleted'）
```

### 2.2 恢复笔记 → 移到常规笔记库

**接口**: `POST /api/v1/notes/{id}/restore`

**要求**:
1. 从回收站（`trash` 表）中**移除**该笔记
2. 将笔记**添加**回常规笔记列表（`notes` 表，并清除删除标记）
3. **不允许**在回收站中保留该笔记

**期望行为**:
```javascript
// 调用 POST /api/v1/notes/123/restore
// 结果：
// - trash表中不再有id=123的记录（或status不再是'deleted'）
// - notes表中有了id=123的记录（且status不是'deleted'）
```

### 2.3 发布草稿 → 移到常规笔记库

**接口**: `POST /api/v1/drafts/{id}/publish`

**要求**:
1. 从草稿箱（`drafts` 表）中**移除**该草稿
2. 将草稿**创建**为常规笔记（添加到 `notes` 表）
3. **不允许**在草稿箱中保留该草稿

**期望行为**:
```javascript
// 调用 POST /api/v1/drafts/456/publish
// 结果：
// - drafts表中不再有id=456的记录
// - notes表中创建了新的笔记记录（基于该草稿，但isDraft=false）
```

### 2.4 彻底删除 → 从回收站删除

**接口**: `DELETE /api/v1/notes/{id}/permanent`

**要求**:
1. 从回收站中**彻底删除**该笔记
2. **不允许**在任何地方保留该笔记（真正的删除）

### 2.5 删除草稿 → 从草稿箱删除

**接口**: `DELETE /api/v1/drafts/{id}`

**要求**:
1. 从草稿箱中**彻底删除**该草稿
2. **不允许**在任何地方保留该草稿

## 三、关键原则

### 3.1 移动而非复制
- 所有操作都应该是**移动**（move），不是**复制**（copy）
- 数据从一个存储空间移动到另一个存储空间时，**必须从源位置删除**
- **不允许**数据同时存在于多个存储空间

### 3.2 数据一致性
- 前端调用后端API后，会根据后端返回的结果更新本地存储
- 后端API的行为必须与前端期望一致，确保数据在前后端都保持一致

### 3.3 验证要求
- 每个移动操作后，后端应该验证数据确实从源位置移除了
- 前端会在操作后验证数据是否正确移动

## 四、当前前端实现

前端已经实现了：
1. ✅ 本地存储层面的数据隔离（三个独立的存储键）
2. ✅ 本地存储层面的移动操作（从源库删除，添加到目标库）
3. ✅ 调用后端API并在成功后更新本地存储

**前端期望后端API的行为与前端本地逻辑保持一致。**


