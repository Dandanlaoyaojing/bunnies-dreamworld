# ğŸ”Œ å°ç¨‹åºè¿æ¥åç«¯æœåŠ¡å™¨æŒ‡å—

## âœ… å·²å®Œæˆçš„é…ç½®

æˆ‘å·²ç»ä¸ºä½ åˆ›å»ºäº†ä»¥ä¸‹æ–‡ä»¶ï¼š

1. **`utils/apiConfig.js`** - APIé…ç½®æ–‡ä»¶ï¼ˆåç«¯åœ°å€é…ç½®ï¼‰
2. **`utils/apiService.js`** - APIè¯·æ±‚æœåŠ¡ç±»ï¼ˆå°è£…æ‰€æœ‰APIè°ƒç”¨ï¼‰
3. **`pages/api-test/`** - APIè¿æ¥æµ‹è¯•é¡µé¢ï¼ˆå®Œæ•´çš„æµ‹è¯•å·¥å…·ï¼‰
4. **`API_USAGE_GUIDE.md`** - è¯¦ç»†çš„APIä½¿ç”¨æŒ‡å—

## ğŸš€ ç«‹å³å¼€å§‹æµ‹è¯•

### æ­¥éª¤ 1ï¼šç¡®ä¿åç«¯æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ

åœ¨åç«¯é¡¹ç›®ç›®å½•è¿è¡Œï¼š
```bash
npm start
```

ä½ åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… æœåŠ¡å™¨è¿è¡Œåœ¨: http://localhost:3000
```

### æ­¥éª¤ 2ï¼šé…ç½®å¾®ä¿¡å¼€å‘è€…å·¥å…·

1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. ç‚¹å‡»å³ä¸Šè§’"è¯¦æƒ…"
3. å‹¾é€‰"ä¸æ ¡éªŒåˆæ³•åŸŸåã€web-viewï¼ˆä¸šåŠ¡åŸŸåï¼‰ã€TLS ç‰ˆæœ¬ä»¥åŠ HTTPS è¯ä¹¦"

### æ­¥éª¤ 3ï¼šæ‰“å¼€æµ‹è¯•é¡µé¢

å°ç¨‹åºå¯åŠ¨åä¼šè‡ªåŠ¨æ‰“å¼€ **APIè¿æ¥æµ‹è¯•é¡µé¢**ï¼ˆå› ä¸ºæˆ‘å·²å°†å®ƒè®¾ä¸ºé¦–é¡µï¼‰

### æ­¥éª¤ 4ï¼šè¿è¡Œæµ‹è¯•

åœ¨æµ‹è¯•é¡µé¢ç‚¹å‡»ï¼š
- **ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•** - è‡ªåŠ¨æµ‹è¯•æ‰€æœ‰APIåŠŸèƒ½
- æˆ–ç‚¹å‡»å•ä¸ªæµ‹è¯•æŒ‰é’®é€ä¸ªæµ‹è¯•

## ğŸ“± æµ‹è¯•é¡µé¢åŠŸèƒ½

æµ‹è¯•é¡µé¢åŒ…å«6ä¸ªæ ¸å¿ƒæµ‹è¯•ï¼š

1. **ğŸ¥ å¥åº·æ£€æŸ¥** - æµ‹è¯•åç«¯è¿æ¥
2. **ğŸ‘¤ ç”¨æˆ·æ³¨å†Œ** - æµ‹è¯•æ³¨å†ŒåŠŸèƒ½
3. **ğŸ” ç”¨æˆ·ç™»å½•** - æµ‹è¯•ç™»å½•åŠŸèƒ½
4. **ğŸ“ åˆ›å»ºç¬”è®°** - æµ‹è¯•ç¬”è®°åˆ›å»º
5. **ğŸ“š è·å–ç¬”è®°åˆ—è¡¨** - æµ‹è¯•ç¬”è®°è¯»å–
6. **ğŸ“Š è·å–ç»Ÿè®¡ä¿¡æ¯** - æµ‹è¯•ç»Ÿè®¡åŠŸèƒ½

## ğŸ”§ å¿«é€Ÿé›†æˆåˆ°ç°æœ‰é¡µé¢

### åœ¨ç™»å½•é¡µé¢ä½¿ç”¨API

```javascript
// pages/login/login.js
const apiService = require('../../utils/apiService.js')

Page({
  // ç°æœ‰çš„ä»£ç ...
  
  // æ·»åŠ APIç™»å½•æ–¹æ³•
  async handleAPILogin() {
    try {
      wx.showLoading({ title: 'ç™»å½•ä¸­...' })
      
      const result = await apiService.login(
        this.data.username,
        this.data.password
      )
      
      wx.hideLoading()
      
      if (result.success) {
        wx.showToast({ title: 'ç™»å½•æˆåŠŸ', icon: 'success' })
        
        // APIä¼šè‡ªåŠ¨ä¿å­˜tokenå’Œç”¨æˆ·ä¿¡æ¯
        // ç›´æ¥è·³è½¬å³å¯
        wx.switchTab({ url: '/pages/1/1' })
      }
    } catch (err) {
      wx.hideLoading()
      wx.showToast({
        title: err.message || 'ç™»å½•å¤±è´¥',
        icon: 'none'
      })
    }
  }
})
```

### åœ¨ç¬”è®°ç¼–è¾‘å™¨ä½¿ç”¨API

```javascript
// pages/note-editor/note-editor.js
const apiService = require('../../utils/apiService.js')

Page({
  // ç°æœ‰çš„ä»£ç ...
  
  // æ·»åŠ ä¿å­˜åˆ°æœåŠ¡å™¨çš„æ–¹æ³•
  async saveToServer() {
    try {
      wx.showLoading({ title: 'ä¿å­˜ä¸­...' })
      
      const result = await apiService.createNote({
        title: this.data.title,
        content: this.data.content,
        category: this.data.category,
        tags: this.data.tags
      })
      
      wx.hideLoading()
      
      if (result.success) {
        wx.showToast({ title: 'ä¿å­˜æˆåŠŸ', icon: 'success' })
        
        // ä¿å­˜ç¬”è®°IDï¼Œç”¨äºåç»­æ›´æ–°
        this.setData({
          noteId: result.data.id
        })
      }
    } catch (err) {
      wx.hideLoading()
      wx.showToast({
        title: err.message || 'ä¿å­˜å¤±è´¥',
        icon: 'none'
      })
    }
  }
})
```

### è·å–ç¬”è®°åˆ—è¡¨

```javascript
// pages/my-notes/my-notes.js
const apiService = require('../../utils/apiService.js')

Page({
  data: {
    notes: []
  },
  
  async loadNotes() {
    try {
      wx.showLoading({ title: 'åŠ è½½ä¸­...' })
      
      const result = await apiService.getNotes({
        page: 1,
        limit: 20
      })
      
      wx.hideLoading()
      
      if (result.success) {
        this.setData({
          notes: result.data.notes
        })
      }
    } catch (err) {
      wx.hideLoading()
      
      // ç½‘ç»œé”™è¯¯æ—¶ï¼Œå°è¯•ä½¿ç”¨æœ¬åœ°ç¼“å­˜
      const cachedNotes = wx.getStorageSync('notes') || []
      this.setData({
        notes: cachedNotes
      })
      
      wx.showToast({
        title: 'ä½¿ç”¨ç¼“å­˜æ•°æ®',
        icon: 'none'
      })
    }
  },
  
  onLoad() {
    this.loadNotes()
  }
})
```

## ğŸ¯ APIæœåŠ¡æä¾›çš„æ–¹æ³•

### è®¤è¯ç›¸å…³
- `apiService.register(username, password, nickname)` - æ³¨å†Œ
- `apiService.login(username, password)` - ç™»å½•
- `apiService.logout()` - ç™»å‡º
- `apiService.refreshToken()` - åˆ·æ–°token

### ç¬”è®°ç®¡ç†
- `apiService.getNotes(params)` - è·å–ç¬”è®°åˆ—è¡¨
- `apiService.getNoteById(id)` - è·å–ç¬”è®°è¯¦æƒ…
- `apiService.createNote(noteData)` - åˆ›å»ºç¬”è®°
- `apiService.updateNote(id, noteData)` - æ›´æ–°ç¬”è®°
- `apiService.deleteNote(id)` - åˆ é™¤ç¬”è®°
- `apiService.searchNotes(keyword, params)` - æœç´¢ç¬”è®°

### æ”¶è—ä¸å›æ”¶ç«™
- `apiService.favoriteNote(id)` - æ”¶è—ç¬”è®°
- `apiService.unfavoriteNote(id)` - å–æ¶ˆæ”¶è—
- `apiService.getFavorites(params)` - è·å–æ”¶è—åˆ—è¡¨
- `apiService.getTrash(params)` - è·å–å›æ”¶ç«™
- `apiService.restoreNote(id)` - æ¢å¤ç¬”è®°
- `apiService.clearTrash()` - æ¸…ç©ºå›æ”¶ç«™

### åˆ†ç±»ä¸æ ‡ç­¾
- `apiService.getCategories()` - è·å–åˆ†ç±»
- `apiService.getTags()` - è·å–æ ‡ç­¾
- `apiService.createTag(tagData)` - åˆ›å»ºæ ‡ç­¾

### ç”¨æˆ·ä¿¡æ¯
- `apiService.getUserProfile()` - è·å–ç”¨æˆ·èµ„æ–™
- `apiService.updateUserProfile(profileData)` - æ›´æ–°èµ„æ–™
- `apiService.getUserStats()` - è·å–ç»Ÿè®¡ä¿¡æ¯

### äº‘åŒæ­¥
- `apiService.syncUpload(notes)` - ä¸Šä¼ åˆ°äº‘ç«¯
- `apiService.syncDownload()` - ä»äº‘ç«¯ä¸‹è½½
- `apiService.getSyncStatus()` - è·å–åŒæ­¥çŠ¶æ€

## âš™ï¸ ä¿®æ”¹APIåœ°å€

å¦‚æœåç«¯éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œä¿®æ”¹ `utils/apiConfig.js`ï¼š

```javascript
// å¼€å‘ç¯å¢ƒï¼ˆæœ¬åœ°æµ‹è¯•ï¼‰
const DEV_API_BASE_URL = 'http://localhost:3000/api/v1'

// ç”Ÿäº§ç¯å¢ƒï¼ˆæ”¹æˆä½ çš„æœåŠ¡å™¨åœ°å€ï¼‰
const PROD_API_BASE_URL = 'https://your-domain.com/api/v1'

// åˆ‡æ¢ç¯å¢ƒ
const API_BASE_URL = PROD_API_BASE_URL  // ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒ
```

## ğŸ›¡ï¸ å®‰å…¨è¯´æ˜

1. **Tokenç®¡ç†**ï¼šTokenä¼šè‡ªåŠ¨ä¿å­˜åœ¨æœ¬åœ°å­˜å‚¨ï¼ŒAPIè°ƒç”¨æ—¶è‡ªåŠ¨é™„åŠ 
2. **è¿‡æœŸå¤„ç†**ï¼šTokenè¿‡æœŸæ—¶ä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ
3. **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰APIè°ƒç”¨éƒ½å·²å°è£…é”™è¯¯å¤„ç†
4. **HTTPSè¦æ±‚**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPSåŸŸå

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: æç¤º"ç½‘ç»œè¯·æ±‚å¤±è´¥"ï¼Ÿ
**A:** æ£€æŸ¥ï¼š
1. åç«¯æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨ï¼ˆnpm startï¼‰
2. å¾®ä¿¡å¼€å‘è€…å·¥å…·æ˜¯å¦å‹¾é€‰"ä¸æ ¡éªŒåˆæ³•åŸŸå"
3. é˜²ç«å¢™æ˜¯å¦é˜»æ­¢äº†3000ç«¯å£

### Q2: æç¤º"æœªæˆæƒ"ï¼Ÿ
**A:** éœ€è¦å…ˆç™»å½•ï¼ŒAPIä¼šè‡ªåŠ¨ç®¡ç†token

### Q3: å¦‚ä½•æŸ¥çœ‹è¯·æ±‚è¯¦æƒ…ï¼Ÿ
**A:** 
1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„Console
2. æŸ¥çœ‹Networké¢æ¿
3. æŸ¥çœ‹åç«¯æœåŠ¡å™¨çš„æ—¥å¿—

### Q4: å¦‚ä½•åœ¨æ­£å¼ç¯å¢ƒä½¿ç”¨ï¼Ÿ
**A:** 
1. éƒ¨ç½²åç«¯åˆ°æœåŠ¡å™¨ï¼ˆä½¿ç”¨HTTPSï¼‰
2. ä¿®æ”¹ `apiConfig.js` ä¸­çš„ PROD_API_BASE_URL
3. åœ¨å°ç¨‹åºåå°é…ç½®æœåŠ¡å™¨åŸŸå
4. åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒåœ°å€

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ çš„å°ç¨‹åºå·²ç»å¯ä»¥ï¼š
- âœ… è¿æ¥åç«¯API
- âœ… ç”¨æˆ·æ³¨å†Œç™»å½•
- âœ… åˆ›å»ºå’Œç®¡ç†ç¬”è®°
- âœ… äº‘ç«¯åŒæ­¥æ•°æ®
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†

**å»ºè®®çš„å¼€å‘æµç¨‹ï¼š**
1. å…ˆç”¨æµ‹è¯•é¡µé¢éªŒè¯æ‰€æœ‰APIæ­£å¸¸
2. é€ä¸ªé¡µé¢é›†æˆAPIè°ƒç”¨
3. ä¿ç•™æœ¬åœ°å­˜å‚¨ä½œä¸ºç¼“å­˜ï¼ˆç¦»çº¿æ”¯æŒï¼‰
4. æµ‹è¯•å®Œæˆåéƒ¨ç½²åˆ°æœåŠ¡å™¨

## ğŸ“š æ›´å¤šæ–‡æ¡£

- è¯¦ç»†APIä½¿ç”¨ç¤ºä¾‹ï¼š`API_USAGE_GUIDE.md`
- åç«¯APIæ–‡æ¡£ï¼šåç«¯é¡¹ç›®çš„README
- æµ‹è¯•é¡µé¢æºç ï¼š`pages/api-test/`

ç¥å¼€å‘é¡ºåˆ©ï¼ğŸš€

