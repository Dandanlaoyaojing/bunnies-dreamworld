# 我的收藏和回收站功能开发说明

## 功能概述

新增了两个重要的笔记管理功能：
1. **我的收藏** - 收藏喜欢的笔记，快速访问
2. **回收站** - 已删除笔记的临时存储，支持恢复或彻底删除

## UI 设计风格

采用与梦之国度页面一致的设计风格：
- 🎨 柔和的蓝灰色调
- ☁️ 浅蓝色选中状态 `#DBEAF8`
- 📦 圆润的卡片设计（20rpx圆角）
- 🌫️ 柔和的阴影效果
- 💙 统一的视觉语言

## 功能详情

### 一、我的收藏功能

#### 页面路径
- `pages/favorites/favorites`

#### 主要功能

1. **查看收藏列表**
   - 显示所有收藏的笔记
   - 支持列表和网格两种视图模式
   - 实时统计收藏数量和总字数

2. **搜索和筛选**
   - 关键词搜索
   - 按分类筛选
   - 多种排序方式（收藏时间、创建时间、标题、字数）

3. **取消收藏**
   - 单个取消收藏
   - 批量取消收藏

4. **查看详情**
   - 点击笔记查看详细内容

#### 数据结构

笔记添加两个字段：
```javascript
{
  id: "...",
  title: "...",
  content: "...",
  isFavorite: true,          // 是否收藏
  favoriteTime: "2025-10-10 12:00:00"  // 收藏时间
}
```

### 二、回收站功能

#### 页面路径
- `pages/trash/trash`

#### 主要功能

1. **查看已删除笔记**
   - 显示所有删除的笔记
   - 支持列表和网格两种视图模式
   - 实时统计回收站数量和总字数

2. **搜索和筛选**
   - 关键词搜索
   - 按分类筛选
   - 多种排序方式（删除时间、创建时间、标题、字数）

3. **恢复笔记**
   - 单个恢复
   - 批量恢复
   - 恢复后笔记状态恢复正常

4. **彻底删除**
   - 单个彻底删除（不可恢复）
   - 批量彻底删除
   - 清空回收站（一键删除所有）

5. **自动删除提醒**
   - 显示笔记剩余保留天数
   - 30天后自动删除警告
   - 剩余7天以内显示红色警告

#### 数据结构

笔记添加两个字段：
```javascript
{
  id: "...",
  title: "...",
  content: "...",
  status: "deleted",         // 删除状态
  deleteTime: "2025-10-10 12:00:00"  // 删除时间
}
```

### 三、笔记详情页增强

#### 新增功能

1. **收藏按钮**
   - 图标：☆（未收藏）/ ⭐（已收藏）
   - 点击切换收藏状态
   - 浅蓝色高亮显示收藏状态

2. **删除功能优化**
   - 删除变为"移到回收站"
   - 提示30天后自动删除
   - 采用柔和的蓝灰色确认按钮

## noteManager 新增方法

### 收藏相关

1. **`toggleFavorite(accountName, noteId, isFavorite)`**
   - 切换笔记的收藏状态
   - 设置/取消收藏时间

2. **`getFavoriteNotes(accountName)`**
   - 获取账户的所有收藏笔记
   - 过滤掉已删除的笔记

### 删除相关

1. **`softDeleteNote(accountName, noteId)`**
   - 软删除笔记（移到回收站）
   - 设置删除状态和删除时间

2. **`getTrashedNotes(accountName)`**
   - 获取回收站的所有笔记
   - 筛选status === 'deleted'的笔记

3. **`restoreNote(accountName, noteId)`**
   - 从回收站恢复笔记
   - 清除删除状态和删除时间

4. **`permanentDeleteNote(accountName, noteId)`**
   - 彻底删除笔记
   - 从数据库中完全移除

5. **`emptyTrash(accountName)`**
   - 清空回收站
   - 删除所有status === 'deleted'的笔记

## 页面结构

### 我的收藏页面

```
┌─────────────────────────┐
│  ← 我的收藏            ☰ │ 导航栏
├─────────────────────────┤
│ ⭐ 5     │ 📝 1234      │ 统计卡片
│  收藏笔记 │  总字数      │
├─────────────────────────┤
│  🔍 搜索收藏笔记...      │ 搜索框
├─────────────────────────┤
│ 📊 收藏时间 │ ▦ 网格   │ 工具栏
├─────────────────────────┤
│ [全部] [艺术] [萌物]... │ 分类筛选
├─────────────────────────┤
│  ┌──────────────────┐   │
│  │ 笔记卡片          │   │ 笔记列表
│  │ ⭐ 💔            │   │
│  └──────────────────┘   │
└─────────────────────────┘
```

### 回收站页面

```
┌─────────────────────────┐
│  ← 回收站              ☰ │ 导航栏
├─────────────────────────┤
│ ⚠️ 笔记保留30天后删除    │ 警告横幅
├─────────────────────────┤
│ 🗑️ 3 │ 📝 567 │ 🔥 清空 │ 统计+操作
│  笔记  │  字数   │        │
├─────────────────────────┤
│  🔍 搜索已删除笔记...    │ 搜索框
├─────────────────────────┤
│ 📊 删除时间 │ ▦ 网格   │ 工具栏
├─────────────────────────┤
│ [全部] [艺术] [萌物]... │ 分类筛选
├─────────────────────────┤
│  ┌──────────────────┐   │
│  │ 笔记卡片          │   │ 笔记列表
│  │ ♻️ 恢复 🔥 删除  │   │
│  │ ⏰ 还有7天将删除  │   │ 警告
│  └──────────────────┘   │
└─────────────────────────┘
```

## 使用流程

### 收藏笔记

```
1. 打开笔记详情
2. 点击底部"收藏"按钮（☆）
3. 图标变为 ⭐，提示"已添加到收藏"
4. 在"我的"页面可以看到收藏数量增加
5. 点击"我的收藏"查看所有收藏
```

### 取消收藏

```
方法1：在笔记详情中
1. 打开已收藏的笔记
2. 点击"已收藏"按钮（⭐）
3. 图标变为 ☆，提示"已取消收藏"

方法2：在收藏列表中
1. 进入"我的收藏"
2. 点击笔记右侧的 💔 按钮
3. 确认取消收藏
```

### 删除笔记

```
1. 在笔记列表或详情中点击"删除"
2. 确认删除（提示将移到回收站）
3. 笔记移到回收站
4. 在"我的"页面查看回收站数量
```

### 恢复笔记

```
1. 进入"回收站"页面
2. 找到要恢复的笔记
3. 点击 ♻️ 恢复按钮
4. 确认恢复
5. 笔记恢复到正常列表
```

### 彻底删除

```
1. 进入"回收站"页面
2. 找到要删除的笔记
3. 点击 🔥 删除按钮
4. 确认彻底删除（警告不可恢复）
5. 笔记永久删除
```

### 清空回收站

```
1. 进入"回收站"页面
2. 点击右上角统计卡片中的"清空"按钮
3. 确认清空（警告不可恢复）
4. 所有回收站笔记永久删除
```

## 批量操作

### 批量取消收藏

```
1. 进入"我的收藏"
2. 点击右上角 ☰ 进入批量模式
3. 选择要取消收藏的笔记
4. 点击"取消收藏"
5. 确认操作
```

### 批量恢复

```
1. 进入"回收站"
2. 点击右上角 ☰ 进入批量模式
3. 选择要恢复的笔记
4. 点击"恢复"
5. 确认操作
```

### 批量彻底删除

```
1. 进入"回收站"
2. 点击右上角 ☰ 进入批量模式
3. 选择要彻底删除的笔记
4. 点击"彻底删除"
5. 确认操作（警告不可恢复）
```

## 数据流转

### 笔记生命周期

```
创建笔记
    ↓
正常状态（可编辑、可查看）
    ↓
[收藏] → isFavorite = true
    ↓
[删除] → status = 'deleted'，移到回收站
    ↓
[30天内]
    ├─ [恢复] → 清除status，回到正常状态
    └─ [彻底删除] → 永久删除
    ↓
[30天后] → 自动永久删除
```

### 数据隔离

- ✅ 收藏笔记只属于当前账户
- ✅ 回收站笔记只属于当前账户
- ✅ 切换账户后数据完全独立
- ✅ 不会看到其他账户的收藏或回收站

## 统计数据更新

### "我的"页面统计

- **笔记数**：不包含已删除的笔记
- **收藏数**：`isFavorite === true && status !== 'deleted'`
- **回收站数**：`status === 'deleted'`

### 实时更新

所有统计数据在以下时机自动更新：
- 切换到"我的"页面时
- 收藏/取消收藏笔记后
- 删除/恢复笔记后
- 彻底删除笔记后

## UI 组件

### 统计卡片

```xml
<view class="stats-card">
  <view class="stat-item">
    <text class="stat-icon">⭐/🗑️</text>
    <view class="stat-content">
      <text class="stat-value">数量</text>
      <text class="stat-label">标签</text>
    </view>
  </view>
</view>
```

### 搜索和筛选

- 搜索框
- 排序选择器
- 视图模式切换
- 分类横向滚动筛选

### 笔记卡片

- 标题和分类徽章
- 内容预览（2行）
- 元数据（日期、字数、特殊标记）
- 标签列表
- 操作按钮

### 批量操作栏

- 选中计数显示
- 操作按钮组
- 浅蓝色背景高亮

## 颜色系统

### 主色调

| 用途 | 颜色代码 | 说明 |
|-----|---------|------|
| 背景渐变 | `#f5f7fa` → `#c3cfe2` | 柔和蓝灰渐变 |
| 主色 | `#DBEAF8` | 浅蓝色 |
| 辅助色 | `#C0D3E2` | 蓝灰色 |
| 卡片背景 | `#ffffff` | 白色 |
| 文字主色 | `#2d3748` | 深灰蓝 |
| 文字次色 | `#4a5568`, `#718096` | 灰色系 |

### 特殊颜色

| 用途 | 颜色代码 | 说明 |
|-----|---------|------|
| 收藏图标 | `#C0D3E2` | 蓝灰色 |
| 删除按钮 | `#e53e3e` | 红色 |
| 警告横幅 | `rgba(245, 158, 11, 0.1)` | 橙色半透明 |
| 选中状态 | `#DBEAF8` | 浅蓝色 |

## 文件列表

### 我的收藏

- `pages/favorites/favorites.js` - 页面逻辑
- `pages/favorites/favorites.wxml` - 页面结构
- `pages/favorites/favorites.wxss` - 页面样式
- `pages/favorites/favorites.json` - 页面配置

### 回收站

- `pages/trash/trash.js` - 页面逻辑
- `pages/trash/trash.wxml` - 页面结构
- `pages/trash/trash.wxss` - 页面样式
- `pages/trash/trash.json` - 页面配置

### 修改的文件

- `utils/noteManager.js` - 添加收藏和删除管理方法
- `pages/note-detail/note-detail.js` - 添加收藏和删除功能
- `pages/note-detail/note-detail.wxml` - 添加收藏按钮
- `pages/note-detail/note-detail.wxss` - 更新按钮样式
- `pages/my-notes/my-notes.js` - 删除改为软删除
- `pages/2/2.js` - 更新统计计算和跳转逻辑
- `app.json` - 注册新页面

## 技术实现

### 软删除机制

- 删除时不真正删除，只标记 `status = 'deleted'`
- 正常列表过滤掉已删除笔记
- 回收站只显示已删除笔记
- 恢复时清除status标记

### 收藏机制

- 添加 `isFavorite` 布尔字段
- 记录 `favoriteTime` 收藏时间
- 收藏列表过滤 `isFavorite === true`
- 支持收藏已删除的笔记（不显示在收藏列表）

### 批量操作

- 使用 `isSelected` 标记选中状态
- 在数据处理时动态添加该字段
- WXML中使用简单的属性访问
- 避免复杂的JavaScript表达式

## 安全机制

### 删除确认

- 单个删除：确认对话框
- 批量删除：确认对话框
- 彻底删除：红色警告 + 不可恢复提示
- 清空回收站：红色警告 + 计数提示

### 数据保护

- 30天回收站保留期
- 删除前明确提示
- 恢复功能保证数据安全
- 彻底删除需要二次确认

## 用户体验优化

### 视觉反馈

- ✅ 收藏成功/取消提示
- ✅ 删除成功提示
- ✅ 恢复成功提示
- ✅ 操作按钮按下效果
- ✅ 选中状态高亮显示

### 操作便捷性

- ✅ 支持搜索和筛选
- ✅ 支持批量操作
- ✅ 多种视图模式
- ✅ 快捷操作按钮

### 信息提示

- ✅ 空状态提示
- ✅ 剩余天数警告
- ✅ 操作结果反馈
- ✅ 错误处理提示

## 测试清单

### 收藏功能

- [x] 在笔记详情中添加收藏
- [x] 在笔记详情中取消收藏
- [x] 查看收藏列表
- [x] 在收藏列表中取消收藏
- [x] 搜索收藏笔记
- [x] 按分类筛选收藏
- [x] 批量取消收藏
- [x] 统计数据正确显示

### 回收站功能

- [x] 删除笔记到回收站
- [x] 查看回收站列表
- [x] 从回收站恢复笔记
- [x] 彻底删除单个笔记
- [x] 批量恢复笔记
- [x] 批量彻底删除
- [x] 清空回收站
- [x] 删除警告显示

### 账户隔离

- [x] 不同账户的收藏独立
- [x] 不同账户的回收站独立
- [x] 切换账户后数据正确

## 未来优化方向

1. **自动清理**
   - 实现30天后自动删除机制
   - 定时任务清理过期笔记

2. **收藏分组**
   - 支持创建收藏夹
   - 分组管理收藏笔记

3. **批量操作**
   - 批量添加收藏
   - 批量移动分类

4. **数据统计**
   - 收藏趋势分析
   - 删除原因分析

## 更新日期

2025-10-10

---

✅ 我的收藏和回收站功能已完全开发完成！UI设计与梦之国度页面风格完全一致。

