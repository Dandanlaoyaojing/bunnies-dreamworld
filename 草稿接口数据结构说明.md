# è‰ç¨¿æ¥å£æ•°æ®ç»“æ„è¯´æ˜

## ğŸ“‹ åç«¯å®é™…è¿”å›æ ¼å¼

### GET /api/v1/drafts æ¥å£è¿”å›æ ¼å¼

```json
{
  "success": true,
  "message": "è·å–è‰ç¨¿åˆ—è¡¨æˆåŠŸ",
  "data": {
    "drafts": [
      {
        "id": "draft_001",
        "title": "è‰ç¨¿æ ‡é¢˜",
        "content": "è‰ç¨¿å†…å®¹",
        "category": "knowledge",
        "tags": "[\"æ ‡ç­¾1\", \"æ ‡ç­¾2\"]",  // JSONå­—ç¬¦ä¸²ï¼Œéœ€è¦è§£æ
        "word_count": 150,
        "created_at": "2024-01-01T00:00:00.000Z",
        "updated_at": "2024-01-01T00:00:00.000Z",
        "user_id": "username"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 25,
      "total_pages": 3
    }
  }
}
```

## ğŸ” å…³é”®å·®å¼‚åˆ†æ

### 1. **data å­—æ®µç»“æ„ä¸åŒ**
- **é¢„æœŸ**ï¼š`data: [...]` (æ•°ç»„)
- **å®é™…**ï¼š`data: { drafts: [...], pagination: {...} }` (å¯¹è±¡)

### 2. **tags å­—æ®µæ ¼å¼ä¸åŒ**
- **é¢„æœŸ**ï¼š`tags: ["æ ‡ç­¾1", "æ ‡ç­¾2"]` (æ•°ç»„)
- **å®é™…**ï¼š`tags: "[\"æ ‡ç­¾1\", \"æ ‡ç­¾2\"]"` (JSONå­—ç¬¦ä¸²)

### 3. **é¢å¤–å­—æ®µ**
- `pagination` - åˆ†é¡µä¿¡æ¯
- `word_count` - å­—æ•°ç»Ÿè®¡
- `created_at`, `updated_at` - æ—¶é—´å­—æ®µ
- `user_id` - ç”¨æˆ·IDå­—æ®µ

## ğŸ› ï¸ å‰ç«¯ä¿®å¤æ–¹æ¡ˆ

éœ€è¦ä¿®æ”¹ `utils/draftCloudService.js` ä¸­çš„æ•°æ®å¤„ç†é€»è¾‘ï¼š

### 1. ä¿®å¤ downloadDrafts æ–¹æ³•

```javascript
// ä¿®å¤å‰
if (result.success) {
  const drafts = Array.isArray(result.data) ? result.data : []
  return {
    success: true,
    drafts: drafts,
    count: drafts.length
  }
}

// ä¿®å¤å
if (result.success) {
  // å¤„ç†æ–°çš„æ•°æ®ç»“æ„
  const responseData = result.data || {}
  const draftsArray = responseData.drafts || []
  
  // è§£ætagså­—æ®µ
  const processedDrafts = draftsArray.map(draft => ({
    ...draft,
    tags: this.parseTags(draft.tags),
    // ç»Ÿä¸€å­—æ®µå
    createTime: draft.created_at,
    updateTime: draft.updated_at,
    userId: draft.user_id
  }))
  
  return {
    success: true,
    drafts: processedDrafts,
    count: processedDrafts.length,
    pagination: responseData.pagination
  }
}
```

### 2. æ·»åŠ tagsè§£ææ–¹æ³•

```javascript
// è§£ætagså­—æ®µ
parseTags(tagsString) {
  try {
    if (typeof tagsString === 'string') {
      return JSON.parse(tagsString)
    } else if (Array.isArray(tagsString)) {
      return tagsString
    } else {
      return []
    }
  } catch (error) {
    console.warn('è§£ætagså¤±è´¥:', error)
    return []
  }
}
```

### 3. ä¿®å¤ syncDraftsFromCloud æ–¹æ³•

```javascript
// ä¿®å¤å‰
const cloudDrafts = downloadResult.drafts || []

// ä¿®å¤å
const cloudDrafts = downloadResult.drafts || []
console.log('äº‘ç«¯è‰ç¨¿æ•°æ®ç±»å‹:', typeof cloudDrafts, Array.isArray(cloudDrafts))
console.log('äº‘ç«¯è‰ç¨¿æ•°æ®å†…å®¹:', cloudDrafts)

// ç¡®ä¿ cloudDrafts æ˜¯æ•°ç»„
if (!Array.isArray(cloudDrafts)) {
  console.error('âŒ äº‘ç«¯è‰ç¨¿æ•°æ®ä¸æ˜¯æ•°ç»„:', cloudDrafts)
  throw new Error('äº‘ç«¯è‰ç¨¿æ•°æ®æ ¼å¼é”™è¯¯ï¼ŒæœŸæœ›æ•°ç»„ä½†å¾—åˆ°: ' + typeof cloudDrafts)
}
```

## ğŸ“ å®Œæ•´çš„æ•°æ®ç»“æ„æ˜ å°„

### åç«¯å­—æ®µ â†’ å‰ç«¯å­—æ®µæ˜ å°„

| åç«¯å­—æ®µ | å‰ç«¯å­—æ®µ | è¯´æ˜ |
|---------|---------|------|
| `id` | `id` | è‰ç¨¿ID |
| `title` | `title` | æ ‡é¢˜ |
| `content` | `content` | å†…å®¹ |
| `category` | `category` | åˆ†ç±» |
| `tags` (JSONå­—ç¬¦ä¸²) | `tags` (æ•°ç»„) | æ ‡ç­¾ï¼Œéœ€è¦è§£æ |
| `word_count` | `wordCount` | å­—æ•° |
| `created_at` | `createTime` | åˆ›å»ºæ—¶é—´ |
| `updated_at` | `updateTime` | æ›´æ–°æ—¶é—´ |
| `user_id` | `userId` | ç”¨æˆ·ID |

### åˆ†é¡µä¿¡æ¯å¤„ç†

```javascript
// åˆ†é¡µä¿¡æ¯
const pagination = responseData.pagination || {}
console.log('åˆ†é¡µä¿¡æ¯:', pagination)
// å¯ä»¥ç”¨äºå®ç°åˆ†é¡µåŠ è½½åŠŸèƒ½
```

## ğŸš€ å®æ–½æ­¥éª¤

1. **ä¿®æ”¹ downloadDrafts æ–¹æ³•**
   - å¤„ç†æ–°çš„æ•°æ®ç»“æ„
   - è§£ætagså­—æ®µ
   - ç»Ÿä¸€å­—æ®µå

2. **æ·»åŠ æ•°æ®è½¬æ¢æ–¹æ³•**
   - æ·»åŠ parseTagsæ–¹æ³•
   - æ·»åŠ å­—æ®µæ˜ å°„é€»è¾‘

3. **æ›´æ–°è°ƒè¯•å·¥å…·**
   - æ›´æ–°è°ƒè¯•å·¥å…·ä»¥æ˜¾ç¤ºæ–°çš„æ•°æ®ç»“æ„
   - æ·»åŠ tagsè§£ææµ‹è¯•

4. **æµ‹è¯•éªŒè¯**
   - ä½¿ç”¨è°ƒè¯•å·¥å…·æµ‹è¯•ä¿®å¤æ•ˆæœ
   - éªŒè¯è‰ç¨¿åŒæ­¥åŠŸèƒ½

## âœ… ä¿®å¤æ•ˆæœ

ä¿®å¤åï¼Œå‰ç«¯å°†èƒ½å¤Ÿï¼š
- âœ… æ­£ç¡®å¤„ç†æ–°çš„æ•°æ®ç»“æ„
- âœ… è§£æJSONå­—ç¬¦ä¸²æ ¼å¼çš„tags
- âœ… ç»Ÿä¸€å­—æ®µåæ˜ å°„
- âœ… å¤„ç†åˆ†é¡µä¿¡æ¯
- âœ… é¿å…forEaché”™è¯¯

## ğŸ“ åç»­å»ºè®®

1. **ä¸åç«¯åè°ƒ**ï¼šç¡®è®¤æ•°æ®ç»“æ„æ˜¯å¦è¿˜ä¼šå˜åŒ–
2. **æ·»åŠ ç±»å‹æ£€æŸ¥**ï¼šå¢å¼ºæ•°æ®éªŒè¯é€»è¾‘
3. **ä¼˜åŒ–æ€§èƒ½**ï¼šè€ƒè™‘åˆ†é¡µåŠ è½½ä¼˜åŒ–
4. **å®Œå–„é”™è¯¯å¤„ç†**ï¼šæ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
