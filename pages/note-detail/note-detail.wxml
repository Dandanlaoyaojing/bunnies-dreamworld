<!--pages/note-detail/note-detail.wxml-->
<view class="note-detail-container">
  <!-- å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-content">
      <view class="nav-left" bindtap="goBack">
        <text class="nav-icon">â†</text>
      </view>
      <text class="nav-title">ç¬”è®°è¯¦æƒ…</text>
      <view class="nav-right">
        <view class="nav-btn share-nav-btn" bindtap="shareNote">
          <text class="nav-btn-icon">ğŸ“¤</text>
        </view>
        <view class="nav-btn edit-nav-btn" bindtap="editNote">
          <text class="nav-btn-icon">âœï¸</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç¬”è®°ä¿¡æ¯å¡ç‰‡ -->
  <view class="note-info-card">
    <view class="card-header">
      <text class="note-title">{{note.title}}</text>
      <view class="note-meta">
        <view class="meta-item">
          <text class="meta-icon">ğŸ“…</text>
          <text class="meta-text">{{note.createTime}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-icon">ğŸ·ï¸</text>
          <text class="meta-text">{{categoryName}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-icon">ğŸ“</text>
          <text class="meta-text">{{note.wordCount}}å­—</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾å¡ç‰‡ -->
  <view class="tags-card" wx:if="{{note.tags && note.tags.length > 0}}">
    <view class="card-header">
      <text class="card-title">æ ‡ç­¾</text>
    </view>
    <view class="tags-container">
      <view class="tag-item" wx:for="{{note.tags}}" wx:key="*this">
        <text class="tag-text">#{{item}}</text>
      </view>
    </view>
  </view>

  <!-- æ¥æºå¡ç‰‡ -->
  <view class="source-card" wx:if="{{note.source}}">
    <view class="card-header">
      <text class="card-title">æ¥æº</text>
    </view>
    <text class="source-text">{{note.source}}</text>
  </view>

  <!-- å†…å®¹å¡ç‰‡ -->
  <view class="content-card">
    <view class="card-header">
      <text class="card-title">ç¬”è®°å†…å®¹</text>
    </view>
    <view class="content-container">
      <text class="content-text">{{note.content}}</text>
    </view>
  </view>

  <!-- é™„ä»¶å¡ç‰‡ -->
  <view class="attachments-card" wx:if="{{(note.images && note.images.length > 0) || (note.voices && note.voices.length > 0)}}">
    <view class="card-header">
      <text class="card-title">é™„ä»¶</text>
    </view>
    
    <!-- å›¾ç‰‡é™„ä»¶ -->
    <view class="images-section" wx:if="{{note.images && note.images.length > 0}}">
      <text class="attachment-type">ğŸ“· å›¾ç‰‡ ({{note.images.length}})</text>
      <view class="images-grid">
        <view class="image-item" wx:for="{{note.images}}" wx:key="id" bindtap="previewImage" data-src="{{item.path}}">
          <image src="{{item.path}}" class="attachment-image" mode="aspectFill" />
        </view>
      </view>
    </view>

    <!-- è¯­éŸ³é™„ä»¶ -->
    <view class="voices-section" wx:if="{{note.voices && note.voices.length > 0}}">
      <text class="attachment-type">ğŸµ è¯­éŸ³ ({{note.voices.length}})</text>
      <view class="voices-list">
        <view class="voice-item" wx:for="{{note.voices}}" wx:key="id">
          <view class="voice-info">
            <text class="voice-duration">{{item.duration}}s</text>
            <text class="voice-time">{{item.createTime}}</text>
          </view>
          <view class="voice-controls">
            <view class="play-btn" bindtap="playVoice" data-id="{{item.id}}">
              <text class="play-icon">â–¶ï¸</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨ä¿¡æ¯å¡ç‰‡ -->
  <view class="footer-card">
    <view class="footer-info">
      <view class="info-item">
        <text class="info-label">åˆ›å»ºæ—¶é—´</text>
        <text class="info-value">{{note.createTime}}</text>
      </view>
      <view class="info-item" wx:if="{{note.updateTime !== note.createTime}}">
        <text class="info-label">æ›´æ–°æ—¶é—´</text>
        <text class="info-value">{{note.updateTime}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="bottom-actions">
    <button class="bottom-btn favorite-btn {{isFavorite ? 'active' : ''}}" bindtap="toggleFavorite">
      <text class="btn-icon">{{isFavorite ? 'â­' : 'â˜†'}}</text>
      <text class="btn-text">{{isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
    </button>
    <button class="bottom-btn edit-btn" bindtap="editNote">
      <text class="btn-icon">âœï¸</text>
      <text class="btn-text">ç¼–è¾‘</text>
    </button>
    <button class="bottom-btn share-btn" bindtap="shareNote">
      <text class="btn-icon">ğŸ“¤</text>
      <text class="btn-text">åˆ†äº«</text>
    </button>
    <button class="bottom-btn delete-btn" bindtap="deleteNote">
      <text class="btn-icon">ğŸ—‘ï¸</text>
      <text class="btn-text">åˆ é™¤</text>
    </button>
  </view>
</view>
