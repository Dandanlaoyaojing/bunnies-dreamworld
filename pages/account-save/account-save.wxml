<!--pages/account-save/account-save.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="header-left" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    <view class="header-title">è´¦æˆ·ä¿å­˜ç®¡ç†</view>
    <view class="header-right"></view>
  </view>

  <!-- è´¦æˆ·é€‰æ‹©åŒºåŸŸ -->
  <view class="account-section">
    <view class="section-title">é€‰æ‹©è´¦æˆ·</view>
    
    <!-- ç°æœ‰è´¦æˆ·åˆ—è¡¨ -->
    <view class="account-list" wx:if="{{availableAccounts.length > 0}}">
      <view class="account-item {{currentAccount === item.name ? 'selected' : ''}}" 
            wx:for="{{availableAccounts}}" wx:key="name"
            bindtap="selectAccount" data-account="{{item.name}}">
        <view class="account-info">
          <text class="account-name">{{item.name}}</text>
          <text class="account-details">{{item.noteCount}}æ¡ç¬”è®° Â· {{item.updateTime}}</text>
        </view>
        <view class="account-status" wx:if="{{currentAccount === item.name}}">
          <text class="status-icon">âœ“</text>
        </view>
      </view>
    </view>
    
    <!-- åˆ›å»ºæ–°è´¦æˆ· -->
    <view class="create-account" bindtap="createNewAccount">
      <text class="create-icon">+</text>
      <text class="create-text">åˆ›å»ºæ–°è´¦æˆ·</text>
    </view>
  </view>

  <!-- è´¦æˆ·ä¿¡æ¯ -->
  <view class="account-info-section" wx:if="{{accountInfo}}">
    <view class="section-title">è´¦æˆ·ä¿¡æ¯</view>
    <view class="info-card">
      <view class="info-item">
        <text class="info-label">è´¦æˆ·åç§°ï¼š</text>
        <text class="info-value">{{accountInfo.accountName}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">ç¬”è®°æ•°é‡ï¼š</text>
        <text class="info-value">{{accountInfo.noteCount}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">æ ‡ç­¾æ•°é‡ï¼š</text>
        <text class="info-value">{{accountInfo.tagCount}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">åˆ†ç±»æ•°é‡ï¼š</text>
        <text class="info-value">{{accountInfo.categoryCount}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">æ›´æ–°æ—¶é—´ï¼š</text>
        <text class="info-value">{{accountInfo.updateTime}}</text>
      </view>
    </view>
  </view>

  <!-- ä¿å­˜æ¨¡å¼é€‰æ‹© -->
  <view class="save-mode-section">
    <view class="section-title">ä¿å­˜æ¨¡å¼</view>
    <view class="mode-options">
      <view class="mode-item {{saveMode === 'all' ? 'active' : ''}}" 
            bindtap="switchSaveMode" data-mode="all">
        <text class="mode-icon">ğŸ“</text>
        <text class="mode-text">å…¨éƒ¨ç¬”è®°</text>
        <text class="mode-count">({{allNotes.length}})</text>
      </view>
      <view class="mode-item {{saveMode === 'selected' ? 'active' : ''}}" 
            bindtap="switchSaveMode" data-mode="selected">
        <text class="mode-icon">âœ…</text>
        <text class="mode-text">é€‰æ‹©ç¬”è®°</text>
        <text class="mode-count">({{selectedNotes.length}})</text>
      </view>
      <view class="mode-item {{saveMode === 'category' ? 'active' : ''}}" 
            bindtap="switchSaveMode" data-mode="category">
        <text class="mode-icon">ğŸ·ï¸</text>
        <text class="mode-text">æŒ‰åˆ†ç±»</text>
        <text class="mode-count">({{categories.length}})</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»é€‰æ‹© -->
  <view class="category-section" wx:if="{{saveMode === 'category'}}">
    <view class="section-title">é€‰æ‹©åˆ†ç±»</view>
    <view class="category-list">
      <view class="category-item {{selectedCategory === item.name ? 'selected' : ''}}"
            wx:for="{{categories}}" wx:key="name"
            bindtap="selectCategory" data-category="{{item.name}}">
        <text class="category-name">{{item.name}}</text>
        <text class="category-count">{{item.count}}æ¡</text>
      </view>
    </view>
  </view>

  <!-- ç¬”è®°åˆ—è¡¨ -->
  <view class="notes-section" wx:if="{{saveMode === 'selected' || saveMode === 'all'}}">
    <view class="section-header">
      <view class="section-title">ç¬”è®°åˆ—è¡¨</view>
      <view class="select-all" bindtap="toggleSelectAll">
        <text class="select-text">{{selectedNotes.length === allNotes.length ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}</text>
      </view>
    </view>
    
    <view class="notes-list">
      <view class="note-item {{selectedNotes.includes(item.id) ? 'selected' : ''}}"
            wx:for="{{allNotes}}" wx:key="id"
            bindtap="toggleNoteSelection" data-id="{{item.id}}">
        <view class="note-checkbox">
          <text class="checkbox-icon" wx:if="{{selectedNotes.includes(item.id)}}">âœ“</text>
        </view>
        <view class="note-content" bindtap="viewNoteDetail" data-id="{{item.id}}">
          <text class="note-title">{{item.title}}</text>
          <text class="note-preview">{{item.content.substring(0, 50)}}...</text>
          <view class="note-meta">
            <text class="note-category">{{item.category}}</text>
            <text class="note-time">{{item.updateTime || item.createTime}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-section">
    <view class="action-buttons">
      <button class="action-btn primary" bindtap="saveToAccount" disabled="{{isLoading}}">
        <text class="btn-text">ä¿å­˜åˆ°è´¦æˆ·</text>
      </button>
      <button class="action-btn secondary" bindtap="loadFromAccount" disabled="{{isLoading}}">
        <text class="btn-text">ä»è´¦æˆ·åŠ è½½</text>
      </button>
      <button class="action-btn danger" bindtap="deleteAccount" disabled="{{isLoading}}">
        <text class="btn-text">åˆ é™¤è´¦æˆ·</text>
      </button>
    </view>
  </view>

  <!-- åŠ è½½è¿›åº¦ -->
  <view class="loading-overlay" wx:if="{{isLoading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">å¤„ç†ä¸­...</text>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{saveProgress}}%"></view>
      </view>
      <text class="progress-text">{{saveProgress}}%</text>
    </view>
  </view>
</view>
