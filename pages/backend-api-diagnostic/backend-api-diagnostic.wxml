<!--pages/backend-api-diagnostic/backend-api-diagnostic.wxml-->
<view class="diagnostic-container">
  <!-- 导航栏 -->
  <view class="nav-bar">
    <view class="nav-content">
      <view class="nav-left" bindtap="goBack">
        <text class="nav-icon">←</text>
      </view>
      <text class="nav-title">后端API诊断</text>
      <view class="nav-right">
        <button class="refresh-btn" bindtap="rerunDiagnostic" disabled="{{isLoading}}">
          <text class="refresh-icon">🔄</text>
        </button>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-section" wx:if="{{isLoading}}">
    <view class="loading-content">
      <text class="loading-icon">🔍</text>
      <text class="loading-text">正在诊断后端API...</text>
      <text class="loading-desc">请稍候，正在检查各项配置</text>
    </view>
  </view>

  <!-- 当前配置信息 -->
  <view class="config-section" wx:if="{{!isLoading}}">
    <view class="config-header">
      <text class="config-title">当前配置</text>
    </view>
    <view class="config-content">
      <view class="config-item">
        <text class="config-label">API密钥：</text>
        <text class="config-value">{{apiKey}}</text>
      </view>
      <view class="config-item">
        <text class="config-label">后端地址：</text>
        <text class="config-value">{{backendUrl}}</text>
      </view>
    </view>
  </view>

  <!-- 诊断结果 -->
  <view class="results-section" wx:if="{{!isLoading && diagnosticResults.length > 0}}">
    <view class="results-header">
      <text class="results-title">诊断结果</text>
      <text class="results-count">{{diagnosticResults.length}}项检查</text>
    </view>
    
    <view class="results-list">
      <view class="result-item {{item.status}}" wx:for="{{diagnosticResults}}" wx:key="id">
        <view class="result-icon">
          <text wx:if="{{item.status === 'success'}}">✅</text>
          <text wx:else>❌</text>
        </view>
        
        <view class="result-content">
          <view class="result-header">
            <text class="result-name">{{item.name}}</text>
            <text class="result-status">{{item.status}}</text>
          </view>
          <text class="result-message">{{item.message}}</text>
          
          <view class="result-actions">
            <button class="detail-btn" bindtap="viewDetails" data-index="{{index}}">
              <text class="detail-icon">📋</text>
              <text class="detail-text">查看详情</text>
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 常见问题解决 -->
  <view class="solutions-section" wx:if="{{!isLoading}}">
    <view class="solutions-header">
      <text class="solutions-title">常见问题解决</text>
    </view>
    
    <view class="solutions-content">
      <view class="solution-item">
        <text class="solution-icon">🔑</text>
        <view class="solution-text">
          <text class="solution-title">API密钥问题</text>
          <text class="solution-desc">如果显示401错误，通常是API密钥无效或格式错误</text>
        </view>
      </view>
      
      <view class="solution-item">
        <text class="solution-icon">🌐</text>
        <view class="solution-text">
          <text class="solution-title">网络连接问题</text>
          <text class="solution-desc">检查后端服务器是否启动，网络连接是否正常</text>
        </view>
      </view>
      
      <view class="solution-item">
        <text class="solution-icon">⚙️</text>
        <view class="solution-text">
          <text class="solution-title">认证头问题</text>
          <text class="solution-desc">确认Authorization头格式正确，包含有效的Bearer token</text>
        </view>
      </view>
      
      <view class="solution-item">
        <text class="solution-icon">🔧</text>
        <view class="solution-text">
          <text class="solution-title">后端服务问题</text>
          <text class="solution-desc">检查后端服务是否正常运行，API端点是否正确</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 快速操作 -->
  <view class="quick-actions" wx:if="{{!isLoading}}">
    <button class="action-btn primary" bindtap="runFullDiagnostic">
      <text class="btn-icon">🔍</text>
      <text class="btn-text">开始诊断</text>
    </button>
    
    <button class="action-btn secondary" bindtap="updateApiKey">
      <text class="btn-icon">🔑</text>
      <text class="btn-text">更新密钥</text>
    </button>
  </view>
</view>
