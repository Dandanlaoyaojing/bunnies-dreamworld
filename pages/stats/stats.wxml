<!--ç»Ÿè®¡é¡µé¢-->
<view class="stats-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <view class="error-icon">âš ï¸</view>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="onRetry">é‡è¯•</button>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="stats-content">
    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <view class="tab-nav">
      <view 
        class="tab-item {{activeTab === 'dashboard' ? 'active' : ''}}"
        data-tab="dashboard"
        bindtap="onTabChange"
      >
        ä»ªè¡¨ç›˜
      </view>
      <view 
        class="tab-item {{activeTab === 'timeline' ? 'active' : ''}}"
        data-tab="timeline"
        bindtap="onTabChange"
      >
        æ—¶é—´çº¿
      </view>
      <view 
        class="tab-item {{activeTab === 'habits' ? 'active' : ''}}"
        data-tab="habits"
        bindtap="onTabChange"
      >
        å†™ä½œä¹ æƒ¯
      </view>
      <view 
        class="tab-item {{activeTab === 'achievements' ? 'active' : ''}}"
        data-tab="achievements"
        bindtap="onTabChange"
      >
        æˆå°±
      </view>
    </view>

    <!-- ä»ªè¡¨ç›˜å†…å®¹ -->
    <view wx:if="{{activeTab === 'dashboard'}}" class="tab-content">
      <view wx:if="{{dashboardData}}" class="dashboard-content">
        <!-- åŸºç¡€ç»Ÿè®¡å¡ç‰‡ -->
        <view class="stats-cards">
          <view class="stat-card">
            <view class="stat-number">{{dashboardData.basicStats.totalNotes || 0}}</view>
            <view class="stat-label">ç¬”è®°æ€»æ•°</view>
          </view>
          <view class="stat-card">
            <view class="stat-number">{{dashboardData.basicStats.totalWords || 0}}</view>
            <view class="stat-label">æ€»å­—æ•°</view>
          </view>
          <view class="stat-card">
            <view class="stat-number">{{dashboardData.basicStats.totalTags || 0}}</view>
            <view class="stat-label">æ ‡ç­¾æ•°é‡</view>
          </view>
          <view class="stat-card">
            <view class="stat-number">{{dashboardData.basicStats.favoriteNotes || 0}}</view>
            <view class="stat-label">æ”¶è—ç¬”è®°</view>
          </view>
        </view>

        <!-- åˆ†ç±»åˆ†å¸ƒ -->
        <view class="section">
          <view class="section-header">
            <text class="section-title">åˆ†ç±»åˆ†å¸ƒ</text>
            <text class="section-action" bindtap="onViewCategoryDistribution">æŸ¥çœ‹è¯¦æƒ…</text>
          </view>
          <view class="category-list">
            <view 
              wx:for="{{dashboardData.categoryStats}}" 
              wx:key="category"
              class="category-item"
            >
              <view class="category-name">{{item.category}}</view>
              <view class="category-count">{{item.count}}ç¯‡</view>
            </view>
          </view>
        </view>

        <!-- çƒ­é—¨æ ‡ç­¾ -->
        <view class="section">
          <view class="section-header">
            <text class="section-title">çƒ­é—¨æ ‡ç­¾</text>
            <text class="section-action" bindtap="onViewWordCloud">æŸ¥çœ‹è¯äº‘</text>
          </view>
          <view class="tag-list">
            <view 
              wx:for="{{dashboardData.tagStats}}" 
              wx:key="name"
              wx:for-item="tag"
              class="tag-item"
              style="background-color: {{tag.color}}"
            >
              {{tag.name}} ({{tag.count}})
            </view>
          </view>
        </view>

        <!-- æ—¶é—´ç»Ÿè®¡ -->
        <view class="section">
          <view class="section-header">
            <text class="section-title">æ—¶é—´ç»Ÿè®¡</text>
          </view>
          <view class="time-stats">
            <view class="time-item">
              <text class="time-label">æœ¬å‘¨</text>
              <text class="time-value">{{dashboardData.timeStats.weekly || 0}}ç¯‡</text>
            </view>
            <view class="time-item">
              <text class="time-label">æœ¬æœˆ</text>
              <text class="time-value">{{dashboardData.timeStats.monthly || 0}}ç¯‡</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ—¶é—´çº¿å†…å®¹ -->
    <view wx:if="{{activeTab === 'timeline'}}" class="tab-content">
      <view class="timeline-content">
        <view wx:if="{{timelineData.length === 0}}" class="empty-state">
          <text class="empty-text">æš‚æ— æ—¶é—´çº¿æ•°æ®</text>
        </view>
        <view wx:else class="timeline-list">
          <view 
            wx:for="{{timelineData}}" 
            wx:key="date"
            class="timeline-item"
          >
            <view class="timeline-date">{{item.date}}</view>
            <view class="timeline-stats">
              <text class="timeline-notes">{{item.note_count}}ç¯‡ç¬”è®°</text>
              <text class="timeline-words">{{item.total_words}}å­—</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å†™ä½œä¹ æƒ¯å†…å®¹ -->
    <view wx:if="{{activeTab === 'habits'}}" class="tab-content">
      <view wx:if="{{habitsData}}" class="habits-content">
        <!-- æœ€æ´»è·ƒæ—¶é—´ -->
        <view class="section">
          <view class="section-title">æœ€æ´»è·ƒæ—¶é—´</view>
          <view class="active-time">
            <text class="active-hour">{{habitsData.mostActiveHour.hour}}ç‚¹</text>
            <text class="active-count">å†™äº†{{habitsData.mostActiveHour.count}}ç¯‡ç¬”è®°</text>
          </view>
        </view>

        <!-- æœ€æ´»è·ƒæ˜ŸæœŸ -->
        <view class="section">
          <view class="section-title">æœ€æ´»è·ƒæ˜ŸæœŸ</view>
          <view class="active-day">
            <text class="day-name">{{habitsData.mostActiveDay.day_of_week}}å¤©</text>
            <text class="day-count">å†™äº†{{habitsData.mostActiveDay.count}}ç¯‡ç¬”è®°</text>
          </view>
        </view>

        <!-- å¹³å‡é•¿åº¦ -->
        <view class="section">
          <view class="section-title">å†™ä½œé•¿åº¦</view>
          <view class="length-stats">
            <view class="length-item">
              <text class="length-label">å¹³å‡</text>
              <text class="length-value">{{habitsData.averageLength.avg_word_count}}å­—</text>
            </view>
            <view class="length-item">
              <text class="length-label">æœ€é•¿</text>
              <text class="length-value">{{habitsData.averageLength.max_word_count}}å­—</text>
            </view>
            <view class="length-item">
              <text class="length-label">æœ€çŸ­</text>
              <text class="length-value">{{habitsData.averageLength.min_word_count}}å­—</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æˆå°±å†…å®¹ -->
    <view wx:if="{{activeTab === 'achievements'}}" class="tab-content">
      <view wx:if="{{achievementsData}}" class="achievements-content">
        <view class="achievement-summary">
          <text class="achievement-count">{{achievementsData.totalUnlocked}}/{{achievementsData.totalAchievements}}</text>
          <text class="achievement-label">å·²è§£é”æˆå°±</text>
        </view>
        
        <view class="achievement-list">
          <view 
            wx:for="{{achievementsData.achievements}}" 
            wx:key="id"
            class="achievement-item {{item.unlocked ? 'unlocked' : 'locked'}}"
          >
            <view class="achievement-icon">{{item.icon}}</view>
            <view class="achievement-info">
              <text class="achievement-name">{{item.name}}</text>
              <text class="achievement-desc">{{item.description}}</text>
            </view>
            <view class="achievement-status">
              <text wx:if="{{item.unlocked}}" class="status-unlocked">âœ“</text>
              <text wx:else class="status-locked">ğŸ”’</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="action-btn sync-btn" bindtap="onSync">
      <text class="btn-icon">ğŸ”„</text>
      <text class="btn-text">åŒæ­¥æ•°æ®</text>
    </button>
    <button class="action-btn detail-btn" bindtap="onViewDetailedStats">
      <text class="btn-icon">ğŸ“Š</text>
      <text class="btn-text">è¯¦ç»†ç»Ÿè®¡</text>
    </button>
  </view>
</view>
