<!--pages/my-notes/my-notes.wxml-->
<view class="my-notes-container">
  <!-- å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-content">
      <view class="nav-left" bindtap="goBack">
        <text class="nav-icon">â†</text>
      </view>
      <text class="nav-title">æˆ‘çš„ç¬”è®°</text>
      <view class="nav-right">
        <view class="nav-btn knowledge-map-nav-btn" bindtap="goToKnowledgeMap">
          <text class="nav-btn-icon">ğŸŒŸ</text>
        </view>
        <view class="nav-btn view-mode-btn" bindtap="toggleViewMode">
          <text class="nav-btn-icon">{{viewMode === 'list' ? 'âŠ' : 'â˜°'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-number">{{statistics.totalNotes}}</text>
        <text class="stat-label">æ€»ç¬”è®°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.totalWords}}</text>
        <text class="stat-label">æ€»å­—æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.totalCategories}}</text>
        <text class="stat-label">åˆ†ç±»</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{statistics.totalTags}}</text>
        <text class="stat-label">æ ‡ç­¾</text>
      </view>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
  <view class="search-filter-section">
    <!-- æœç´¢æ  -->
    <view class="search-box">
      <input class="search-input" 
             placeholder="æœç´¢ç¬”è®°..." 
             value="{{searchKeyword}}" 
             bindinput="onSearchInput" />
      <view class="search-btn" bindtap="performSearch">
        <text class="search-icon">ğŸ”</text>
      </view>
    </view>

    <!-- å¿«é€Ÿç­›é€‰æŒ‰é’® -->
    <view class="quick-filters">
      <view class="filter-btn {{selectedCategory === '' ? 'active' : ''}}" 
            bindtap="filterByCategory" data-category="">
        <text class="filter-text">å…¨éƒ¨</text>
      </view>
      <view class="filter-btn {{selectedCategory === 'art' ? 'active' : ''}}" 
            bindtap="filterByCategory" data-category="art">
        <image src="/images/menu/art.png" class="filter-icon" />
        <text class="filter-text">è‰ºæœ¯</text>
      </view>
      <view class="filter-btn {{selectedCategory === 'cute' ? 'active' : ''}}" 
            bindtap="filterByCategory" data-category="cute">
        <image src="/images/menu/cute.png" class="filter-icon" />
        <text class="filter-text">èŒç‰©</text>
      </view>
      <view class="filter-btn {{selectedCategory === 'dreams' ? 'active' : ''}}" 
            bindtap="filterByCategory" data-category="dreams">
        <image src="/images/menu/dreams.png" class="filter-icon" />
        <text class="filter-text">æ¢¦æ¸¸</text>
      </view>
      <view class="filter-btn {{selectedCategory === 'foods' ? 'active' : ''}}" 
            bindtap="filterByCategory" data-category="foods">
        <image src="/images/menu/foods.png" class="filter-icon" />
        <text class="filter-text">ç¾é£Ÿ</text>
      </view>
      <view class="filter-btn {{selectedCategory === 'happiness' ? 'active' : ''}}" 
            bindtap="filterByCategory" data-category="happiness">
        <image src="/images/menu/happiness.png" class="filter-icon" />
        <text class="filter-text">è¶£äº‹</text>
      </view>
      <view class="filter-btn {{selectedCategory === 'knowledge' ? 'active' : ''}}" 
            bindtap="filterByCategory" data-category="knowledge">
        <image src="/images/menu/knowledge.png" class="filter-icon" />
        <text class="filter-text">çŸ¥è¯†</text>
      </view>
      <view class="filter-btn {{selectedCategory === 'sights' ? 'active' : ''}}" 
            bindtap="filterByCategory" data-category="sights">
        <image src="/images/menu/sights.png" class="filter-icon" />
        <text class="filter-text">é£æ™¯</text>
      </view>
      <view class="filter-btn {{selectedCategory === 'thinking' ? 'active' : ''}}" 
            bindtap="filterByCategory" data-category="thinking">
        <image src="/images/menu/thinking.png" class="filter-icon" />
        <text class="filter-text">æ€è€ƒ</text>
      </view>
    </view>

    <!-- é«˜çº§ç­›é€‰ -->
    <view class="advanced-filters">
      <view class="filter-group">
        <text class="filter-label">æ’åºæ–¹å¼:</text>
        <picker bindchange="onSortChange" value="{{sortIndex}}" range="{{sortOptions}}">
          <view class="picker-btn">
            <text class="picker-text">{{sortOptions[sortIndex]}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
      
      <view class="filter-group">
        <text class="filter-label">æ—¶é—´èŒƒå›´:</text>
        <view class="date-range-container">
          <picker mode="date" bindchange="onStartDateChange" value="{{startDate}}">
            <view class="picker-btn date-picker">
              <text class="picker-text">{{startDate || 'å¼€å§‹æ—¥æœŸ'}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
          <text class="date-separator">è‡³</text>
          <picker mode="date" bindchange="onEndDateChange" value="{{endDate}}">
            <view class="picker-btn date-picker">
              <text class="picker-text">{{endDate || 'ç»“æŸæ—¥æœŸ'}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>
      </view>

      <view class="filter-group">
        <text class="filter-label">çƒ­é—¨æ ‡ç­¾:</text>
        <view class="tag-filters">
          <view class="tag-filter {{selectedTags.includes(item.name) ? 'active' : ''}}" 
                wx:for="{{popularTags}}" wx:key="name" 
                bindtap="toggleTagFilter" data-tag="{{item.name}}">
            <text class="tag-text">#{{item.name}}</text>
            <text class="tag-count">{{item.count}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç¬”è®°åˆ—è¡¨/ç½‘æ ¼ -->
  <view class="notes-container">
    <!-- åˆ—è¡¨è§†å›¾ -->
    <view class="notes-list" wx:if="{{viewMode === 'list'}}">
      <view class="note-item" wx:for="{{filteredNotes}}" wx:key="id">
        <view class="note-main" bindtap="openNote" data-note="{{item}}">
          <view class="note-header">
            <view class="note-title-section">
              <text class="note-title">{{item.title || 'æ— æ ‡é¢˜'}}</text>
              <view class="note-category">
                <image src="/images/menu/{{item.category}}.png" class="category-icon" />
                <text class="category-name">{{getCategoryName(item.category)}}</text>
              </view>
            </view>
            <view class="note-time">
              <text class="create-time">{{item.createTime}}</text>
              <text class="update-time" wx:if="{{item.updateTime && item.updateTime !== item.createTime}}">
                æ›´æ–°: {{item.updateTime}}
              </text>
            </view>
          </view>
          
          <view class="note-content">
            <text class="note-text">{{item.content}}</text>
          </view>
          
          <view class="note-footer">
            <view class="note-meta">
              <view class="note-tags">
                <text class="{{item.sourceTags && item.sourceTags.includes(tag) ? 'source-tag' : 'tag'}}" 
                      wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">
                  #{{tag}}
                </text>
              </view>
            </view>
            <view class="note-stats">
              <text class="word-count">{{item.wordCount || 0}}å­—</text>
              <text class="attachment-count" wx:if="{{item.imageCount || item.voiceCount}}">
                ğŸ“{{(item.imageCount || 0) + (item.voiceCount || 0)}}
              </text>
            </view>
          </view>
        </view>
        
        <view class="note-actions">
          <view class="action-btn edit-btn" bindtap="editNote" data-note="{{item}}">
            <text class="action-text">ç¼–è¾‘</text>
          </view>
          <view class="action-btn share-btn" bindtap="shareNote" data-note="{{item}}">
            <text class="action-text">åˆ†äº«</text>
          </view>
          <view class="action-btn delete-btn" bindtap="deleteNote" data-id="{{item.id}}">
            <text class="action-text">åˆ é™¤</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç½‘æ ¼è§†å›¾ -->
    <view class="notes-grid" wx:if="{{viewMode === 'grid'}}">
      <view class="note-card" wx:for="{{filteredNotes}}" wx:key="id">
        <view class="card-main" bindtap="openNote" data-note="{{item}}">
          <view class="card-header">
            <text class="card-title">{{item.title || 'æ— æ ‡é¢˜'}}</text>
            <view class="card-category">
              <image src="/images/menu/{{item.category}}.png" class="card-category-icon" />
            </view>
          </view>
          
          <view class="card-content">
            <text class="card-text">{{item.content}}</text>
          </view>
          
          <view class="card-footer">
            <view class="card-meta">
              <view class="card-tags">
                <text class="card-tag {{item.sourceTags && item.sourceTags.includes(tag) ? 'source-tag' : ''}}" 
                      wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">
                  #{{tag}}
                </text>
              </view>
            </view>
            <text class="card-time">{{item.createTime}}</text>
          </view>
        </view>
        
        <view class="card-overlay">
          <view class="card-actions">
            <view class="card-action-btn" bindtap="editNote" data-note="{{item}}">
              <text class="card-action-icon">âœï¸</text>
            </view>
            <view class="card-action-btn" bindtap="shareNote" data-note="{{item}}">
              <text class="card-action-icon">ğŸ“¤</text>
            </view>
            <view class="card-action-btn" bindtap="deleteNote" data-id="{{item.id}}">
              <text class="card-action-icon">ğŸ—‘ï¸</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{filteredNotes.length === 0}}">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">{{getEmptyStateText()}}</text>
      <button class="create-btn" bindtap="goToEditor">åˆ›å»ºç¬”è®°</button>
    </view>
  </view>

  <!-- æ‰¹é‡æ“ä½œå·¥å…·æ  -->
  <view class="batch-toolbar" wx:if="{{selectedNotes.length > 0}}">
    <view class="batch-info">
      <text class="batch-count">å·²é€‰æ‹© {{selectedNotes.length}} æ¡ç¬”è®°</text>
    </view>
    <view class="batch-actions">
      <view class="batch-btn" bindtap="batchDelete">
        <text class="batch-btn-text">åˆ é™¤</text>
      </view>
      <view class="batch-btn" bindtap="batchExport">
        <text class="batch-btn-text">å¯¼å‡º</text>
      </view>
      <view class="batch-btn" bindtap="batchTag">
        <text class="batch-btn-text">æ ‡ç­¾</text>
      </view>
    </view>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="floating-actions">
    <view class="floating-btn create-btn" bindtap="goToEditor">
      <text class="floating-icon">+</text>
    </view>
    <view class="floating-btn search-btn" bindtap="showAdvancedSearch">
      <text class="floating-icon">ğŸ”</text>
    </view>
    <view class="floating-btn knowledge-map-btn" bindtap="goToKnowledgeMap">
      <text class="floating-icon">ğŸŒŸ</text>
    </view>
    <view class="floating-btn batch-btn" bindtap="toggleBatchMode">
      <text class="floating-icon">â˜‘ï¸</text>
    </view>
  </view>
</view>
