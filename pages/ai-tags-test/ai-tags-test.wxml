<!--AI智能标签测试页面-->
<view class="container">
  <view class="header">
    <text class="title">AI智能标签测试</text>
    <text class="subtitle">验证标签生成规则是否正确执行</text>
  </view>

  <!-- 测试控制区 -->
  <view class="test-controls">
    <button class="test-btn primary" bindtap="runAllTests" disabled="{{loading}}">
      <text class="btn-text">运行所有测试</text>
    </button>
    
    <view class="individual-tests">
      <button class="test-btn" bindtap="testSmartTags" disabled="{{loading}}">
        <text class="btn-text">智能标签生成</text>
      </button>
      
      <button class="test-btn" bindtap="testInitialTags" disabled="{{loading}}">
        <text class="btn-text">初始标签生成</text>
      </button>
      
      <button class="test-btn" bindtap="testAdditionalTags" disabled="{{loading}}">
        <text class="btn-text">追加标签生成</text>
      </button>
      
      <button class="test-btn" bindtap="testRetryTags" disabled="{{loading}}">
        <text class="btn-text">重试标签生成</text>
      </button>
      
      <button class="test-btn" bindtap="testCategoryContext" disabled="{{loading}}">
        <text class="btn-text">分类上下文测试</text>
      </button>
    </view>
    
    <button class="test-btn secondary" bindtap="clearResults" disabled="{{loading}}">
      <text class="btn-text">清除结果</text>
    </button>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <text class="loading-text">正在执行: {{currentTest}}</text>
  </view>

  <!-- 测试结果区 -->
  <view class="results-section" wx:if="{{testResults.length > 0}}">
    <view class="section-header">
      <text class="section-title">测试结果</text>
      <text class="result-count">共 {{testResults.length}} 项测试</text>
    </view>
    
    <view class="results-list">
      <view class="result-item" wx:for="{{testResults}}" wx:key="index">
        <view class="result-header">
          <view class="result-info">
            <text class="result-name">{{item.name}}</text>
            <text class="result-time">{{item.timestamp}}</text>
          </view>
          <view class="result-status {{item.success ? 'success' : 'failed'}}">
            <text class="status-text">{{item.success ? '成功' : '失败'}}</text>
          </view>
        </view>
        
        <view class="result-content">
          <view class="result-details">
            <text class="detail-label">测试信息:</text>
            <text class="detail-value" wx:if="{{item.testInfo}}">
              {{item.testInfo.expectedCount || item.testInfo.testCases || '无'}}
            </text>
          </view>
          
          <view class="result-details" wx:if="{{item.result.success && item.result.tags}}">
            <text class="detail-label">生成标签:</text>
            <view class="tags-container">
              <text class="tag" wx:for="{{item.result.tags}}" wx:key="*this" wx:for-item="tag">
                {{tag}}
              </text>
            </view>
          </view>
          
          <view class="result-details" wx:if="{{!item.result.success}}">
            <text class="detail-label">错误信息:</text>
            <text class="error-message">{{item.result.error || item.result.message}}</text>
          </view>
        </view>
        
        <view class="result-actions">
          <button class="action-btn" bindtap="viewDetail" data-index="{{index}}">
            <text class="action-text">查看详情</text>
          </button>
          <button class="action-btn" bindtap="copyResult" data-index="{{index}}">
            <text class="action-text">复制结果</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- 规则说明 -->
  <view class="rules-section">
    <view class="section-header">
      <text class="section-title">标签生成规则</text>
    </view>
    
    <view class="rules-list">
      <view class="rule-item">
        <text class="rule-title">智能标签生成（增强版）</text>
        <text class="rule-desc">生成8-15个精准标签，涵盖主题、情感、类型、风格等维度</text>
      </view>
      
      <view class="rule-item">
        <text class="rule-title">初始标签生成</text>
        <text class="rule-desc">OCR识别后生成3-5个初始标签，快速了解内容要点</text>
      </view>
      
      <view class="rule-item">
        <text class="rule-title">追加标签生成</text>
        <text class="rule-desc">生成3个新的不重复标签，与已有标签形成补充</text>
      </view>
      
      <view class="rule-item">
        <text class="rule-title">重试标签生成</text>
        <text class="rule-desc">使用更高创造性生成3个标签，避免常见标签</text>
      </view>
      
      <view class="rule-item">
        <text class="rule-title">分类上下文</text>
        <text class="rule-desc">根据8个分类生成针对性标签，提高标签质量</text>
      </view>
      
      <view class="rule-item">
        <text class="rule-title">标签要求</text>
        <text class="rule-desc">中文标签，每个不超过4个字符，自动过滤常见词汇</text>
      </view>
    </view>
  </view>
</view>
