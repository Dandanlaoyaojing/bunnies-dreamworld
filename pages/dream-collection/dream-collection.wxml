<!--pages/dream-collection/dream-collection.wxml-->
<view class="dream-collection-container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="nav-bar">
    <view class="nav-content">
      <view class="nav-left" bindtap="goBack">
        <text class="nav-icon">â†</text>
      </view>
      <text class="nav-title">æ¢¦å¢ƒæ”¶è—å¤¹</text>
      <view class="nav-right">
        <text class="nav-icon">ğŸ”</text>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input" placeholder="æœç´¢æ¢¦å¢ƒå†…å®¹..." 
             value="{{searchKeyword}}" bindinput="onSearchInput"/>
    </view>
  </view>

  <!-- æ ‡ç­¾é¡µ -->
  <view class="tab-bar">
    <view class="tab-item {{currentTab === 'all' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="all">
      <text class="tab-text">å…¨éƒ¨</text>
      <text class="tab-count">{{collectedDreams.length}}</text>
    </view>
    <view class="tab-item {{currentTab === 'recent' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="recent">
      <text class="tab-text">æœ€è¿‘</text>
    </view>
    <view class="tab-item {{currentTab === 'favorites' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="favorites">
      <text class="tab-text">æœ€çˆ±</text>
    </view>
  </view>

  <!-- æ’åºé€‰é¡¹ -->
  <view class="sort-section">
    <view class="sort-options">
      <text class="sort-label">æ’åºï¼š</text>
      <view class="sort-item {{sortBy === 'time' && sortOrder === 'desc' ? 'active' : ''}}"
            bindtap="selectSort" data-sort="time" data-order="desc">
        <text class="sort-text">æœ€æ–°</text>
      </view>
      <view class="sort-item {{sortBy === 'time' && sortOrder === 'asc' ? 'active' : ''}}"
            bindtap="selectSort" data-sort="time" data-order="asc">
        <text class="sort-text">æœ€æ—©</text>
      </view>
      <view class="sort-item {{sortBy === 'type' ? 'active' : ''}}"
            bindtap="selectSort" data-sort="type" data-order="desc">
        <text class="sort-text">ç±»å‹</text>
      </view>
      <view class="sort-item {{sortBy === 'length' && sortOrder === 'desc' ? 'active' : ''}}"
            bindtap="selectSort" data-sort="length" data-order="desc">
        <text class="sort-text">æœ€é•¿</text>
      </view>
    </view>
  </view>

  <!-- æ¢¦å¢ƒåˆ—è¡¨ -->
  <view class="dream-list" wx:if="{{filteredDreams && filteredDreams.length > 0}}">
    <view class="dream-item" wx:for="{{filteredDreams}}" wx:key="id"
          bindtap="viewDreamDetail" data-id="{{item.id}}">
      <view class="dream-header">
        <view class="dream-type">
          <text class="type-icon">{{getDreamTypeIcon(item.params.dreamType)}}</text>
          <text class="type-name">{{getDreamTypeName(item.params.dreamType)}}</text>
        </view>
        <view class="dream-time">
          <text class="time-text">{{formatTime(item.collectTime || item.createTime)}}</text>
        </view>
      </view>
      
      <view class="dream-preview">
        <text class="preview-text">{{item.content.substring(0, 100)}}{{item.content.length > 100 ? '...' : ''}}</text>
      </view>
      
      <view class="dream-footer">
        <view class="dream-stats">
          <text class="stat-item">{{item.content.length}}å­—</text>
          <text class="stat-item">{{item.params.dreamStyle}}</text>
          <text class="stat-item">{{item.params.emotionTone}}</text>
        </view>
        <view class="dream-actions">
          <view class="action-icon" bindtap="shareDream" data-id="{{item.id}}" catchtap="true">
            <text class="icon">ğŸ“¤</text>
          </view>
          <view class="action-icon" bindtap="uncollectDream" data-id="{{item.id}}" catchtap="true">
            <text class="icon">ğŸ’”</text>
          </view>
          <view class="action-icon" bindtap="deleteDream" data-id="{{item.id}}" catchtap="true">
            <text class="icon">ğŸ—‘ï¸</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <view class="empty-icon">ğŸ“š</view>
    <text class="empty-title">æš‚æ— æ”¶è—çš„æ¢¦å¢ƒ</text>
    <text class="empty-desc">å»æ¢¦ä¹‹å›½åº¦åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ¢¦å¢ƒå§</text>
    <button class="create-btn" bindtap="goBack">
      <text class="btn-text">å»åˆ›å»ºæ¢¦å¢ƒ</text>
    </button>
  </view>

  <!-- æ¢¦å¢ƒè¯¦æƒ…å¼¹çª— -->
  <view class="dream-detail-modal {{showDreamDetail ? 'show' : ''}}" wx:if="{{selectedDream}}">
    <view class="modal-mask" bindtap="closeDreamDetail"></view>
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-title">
          <text class="title-icon">{{getDreamTypeIcon(selectedDream.params.dreamType)}}</text>
          <text class="title-text">{{getDreamTypeName(selectedDream.params.dreamType)}}</text>
        </view>
        <view class="modal-close" bindtap="closeDreamDetail">
          <text class="close-icon">âœ•</text>
        </view>
      </view>
      
      <view class="modal-body">
        <view class="dream-meta">
          <text class="meta-item">åˆ›å»ºæ—¶é—´ï¼š{{formatTime(selectedDream.createTime)}}</text>
          <text class="meta-item">æ”¶è—æ—¶é—´ï¼š{{formatTime(selectedDream.collectTime)}}</text>
          <text class="meta-item">å­—æ•°ï¼š{{selectedDream.content.length}}å­—</text>
        </view>
        
        <view class="dream-full-content">
          <text class="full-text">{{selectedDream.content}}</text>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="modal-btn share-btn" bindtap="shareDream" data-id="{{selectedDream.id}}">
          <text class="btn-icon">ğŸ“¤</text>
          <text class="btn-text">åˆ†äº«</text>
        </button>
        <button class="modal-btn uncollect-btn" bindtap="uncollectDream" data-id="{{selectedDream.id}}">
          <text class="btn-icon">ğŸ’”</text>
          <text class="btn-text">å–æ¶ˆæ”¶è—</text>
        </button>
        <button class="modal-btn delete-btn" bindtap="deleteDream" data-id="{{selectedDream.id}}">
          <text class="btn-icon">ğŸ—‘ï¸</text>
          <text class="btn-text">åˆ é™¤</text>
        </button>
      </view>
    </view>
  </view>
</view>
