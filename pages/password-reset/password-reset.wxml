<!--pages/password-reset/password-reset.wxml - 密码重置页面-->
<view class="container">
  <!-- 头部 -->
  <view class="header">
    <view class="back-btn" bindtap="goBack">
      <text class="back-icon">←</text>
    </view>
    <text class="title">密码重置</text>
    <view class="placeholder"></view>
  </view>

  <!-- 步骤指示器 -->
  <view class="step-indicator">
    <view class="step {{currentStep >= 1 ? 'active' : ''}} {{currentStep > 1 ? 'completed' : ''}}">
      <view class="step-number">1</view>
      <text class="step-text">验证身份</text>
    </view>
    <view class="step-line {{currentStep > 1 ? 'active' : ''}}"></view>
    <view class="step {{currentStep >= 2 ? 'active' : ''}} {{currentStep > 2 ? 'completed' : ''}}">
      <view class="step-number">2</view>
      <text class="step-text">验证码</text>
    </view>
    <view class="step-line {{currentStep > 2 ? 'active' : ''}}"></view>
    <view class="step {{currentStep >= 3 ? 'active' : ''}}">
      <view class="step-number">3</view>
      <text class="step-text">新密码</text>
    </view>
  </view>

  <!-- 步骤1: 验证身份 -->
  <view class="step-content" wx:if="{{currentStep === 1}}">
    <view class="step-title">验证身份</view>
    <text class="step-desc">请输入您的用户名和邮箱地址，我们将发送验证码到您的邮箱</text>

    <!-- 用户名输入 -->
    <view class="input-group">
      <view class="input-container {{usernameFocused ? 'focused' : ''}}">
        <text class="input-icon">👤</text>
        <input 
          class="auth-input" 
          placeholder="用户名" 
          value="{{username}}"
          bindinput="onUsernameInput"
          bindfocus="onUsernameFocus"
          bindblur="onUsernameBlur"
        />
      </view>
      <text class="input-error" wx:if="{{usernameError}}">{{usernameError}}</text>
    </view>

    <!-- 邮箱输入 -->
    <view class="input-group">
      <view class="input-container {{emailFocused ? 'focused' : ''}}">
        <text class="input-icon">📧</text>
        <input 
          class="auth-input" 
          placeholder="邮箱地址" 
          value="{{email}}"
          bindinput="onEmailInput"
          bindfocus="onEmailFocus"
          bindblur="onEmailBlur"
        />
      </view>
      <text class="input-error" wx:if="{{emailError}}">{{emailError}}</text>
    </view>
  </view>

  <!-- 步骤2: 验证码 -->
  <view class="step-content" wx:if="{{currentStep === 2}}">
    <view class="step-title">输入验证码</view>
    <text class="step-desc">验证码已发送到 {{email}}，请输入6位数字验证码</text>

    <!-- 验证码输入 -->
    <view class="input-group">
      <view class="input-container {{resetCodeFocused ? 'focused' : ''}}">
        <text class="input-icon">🔢</text>
        <input 
          class="auth-input" 
          placeholder="请输入6位验证码" 
          type="number"
          maxlength="6"
          value="{{resetCode}}"
          bindinput="onResetCodeInput"
          bindfocus="onResetCodeFocus"
          bindblur="onResetCodeBlur"
        />
      </view>
      <text class="input-error" wx:if="{{resetCodeError}}">{{resetCodeError}}</text>
    </view>

    <!-- 重新发送 -->
    <view class="resend-section">
      <text class="resend-text">没有收到验证码？</text>
      <text class="resend-btn {{countdown > 0 ? 'disabled' : ''}}" bindtap="resendCode">
        {{countdown > 0 ? `重新发送(${countdown}s)` : '重新发送'}}
      </text>
    </view>
  </view>

  <!-- 步骤3: 新密码 -->
  <view class="step-content" wx:if="{{currentStep === 3}}">
    <view class="step-title">设置新密码</view>
    <text class="step-desc">请设置您的新密码，密码长度至少6个字符</text>

    <!-- 新密码输入 -->
    <view class="input-group">
      <view class="input-container {{newPasswordFocused ? 'focused' : ''}}">
        <text class="input-icon">🔒</text>
        <input 
          class="auth-input" 
          placeholder="新密码" 
          password="{{!showNewPassword}}"
          value="{{newPassword}}"
          bindinput="onNewPasswordInput"
          bindfocus="onNewPasswordFocus"
          bindblur="onNewPasswordBlur"
        />
        <view class="password-toggle" bindtap="toggleNewPassword">
          <text class="toggle-icon">{{showNewPassword ? '🙈' : '👁'}}</text>
        </view>
      </view>
      <text class="input-error" wx:if="{{newPasswordError}}">{{newPasswordError}}</text>
    </view>

    <!-- 确认密码输入 -->
    <view class="input-group">
      <view class="input-container {{confirmPasswordFocused ? 'focused' : ''}}">
        <text class="input-icon">🔒</text>
        <input 
          class="auth-input" 
          placeholder="确认新密码" 
          password="{{!showConfirmPassword}}"
          value="{{confirmPassword}}"
          bindinput="onConfirmPasswordInput"
          bindfocus="onConfirmPasswordFocus"
          bindblur="onConfirmPasswordBlur"
        />
        <view class="password-toggle" bindtap="toggleConfirmPassword">
          <text class="toggle-icon">{{showConfirmPassword ? '🙈' : '👁'}}</text>
        </view>
      </view>
      <text class="input-error" wx:if="{{confirmPasswordError}}">{{confirmPasswordError}}</text>
    </view>
  </view>

  <!-- 提交按钮 -->
  <button 
    class="submit-btn {{canSubmit ? 'active' : ''}}"
    bindtap="onSubmit"
    disabled="{{!canSubmit || isLoading}}"
  >
    {{isLoading ? '处理中...' : (currentStep === 1 ? '发送验证码' : (currentStep === 2 ? '验证' : '重置密码'))}}
  </button>

  <!-- 返回登录 -->
  <view class="footer">
    <text class="footer-text">想起密码了？</text>
    <text class="footer-link" bindtap="goToLogin">返回登录</text>
  </view>
</view>
