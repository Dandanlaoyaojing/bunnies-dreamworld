<!--pages/note-manager/note-manager.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨ç»Ÿè®¡åŒºåŸŸ -->
  <view class="stats-header">
    <view class="stats-item">
      <text class="stats-number">{{statistics.totalNotes}}</text>
      <text class="stats-label">æ€»ç¬”è®°</text>
    </view>
    <view class="stats-item">
      <text class="stats-number">{{statistics.totalWords}}</text>
      <text class="stats-label">æ€»å­—æ•°</text>
    </view>
    <view class="stats-item">
      <text class="stats-number">{{statistics.totalTags}}</text>
      <text class="stats-label">æ ‡ç­¾æ•°</text>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-box">
      <input class="search-input" 
             placeholder="æœç´¢æ‰€æœ‰ç¬”è®°..." 
             value="{{searchKeyword}}" 
             bindinput="onSearchInput" />
      <text class="search-icon">ğŸ”</text>
    </view>
    
    <view class="filter-bar">
      <picker mode="selector" range="{{categoryOptions}}" range-key="name" value="{{selectedCategoryIndex}}" bindchange="onCategoryChange">
        <view class="filter-item">
          <text class="filter-label">{{selectedCategory.name}}</text>
          <text class="filter-arrow">â–¼</text>
        </view>
      </picker>
      
      <picker mode="selector" range="{{tagOptions}}" range-key="name" value="{{selectedTagIndex}}" bindchange="onTagChange">
        <view class="filter-item">
          <text class="filter-label">{{selectedTag.name}}</text>
          <text class="filter-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- æ ‡ç­¾äº‘åŒºåŸŸ -->
  <view class="tags-section" wx:if="{{popularTags.length > 0}}">
    <text class="section-title">çƒ­é—¨æ ‡ç­¾</text>
    <view class="tags-cloud">
      <text class="tag-cloud-item" 
            wx:for="{{popularTags}}" 
            wx:key="name"
            style="font-size: {{item.count * 2 + 20}}rpx;"
            bindtap="filterByTag" 
            data-tag="{{item.name}}">
        #{{item.name}}
      </text>
    </view>
  </view>

  <!-- åˆ†ç±»ç»Ÿè®¡åŒºåŸŸ -->
  <view class="categories-section">
    <text class="section-title">åˆ†ç±»ç»Ÿè®¡</text>
    <view class="categories-grid">
      <view class="category-item" 
            wx:for="{{categoryStats}}" 
            wx:key="name"
            bindtap="filterByCategory" 
            data-category="{{item.name}}">
        <view class="category-icon" style="background: {{getCategoryColor(item.name)}}"></view>
        <text class="category-name">{{item.name}}</text>
        <text class="category-count">{{item.count}}</text>
      </view>
    </view>
  </view>

  <!-- ç¬”è®°åˆ—è¡¨ -->
  <view class="notes-section">
    <view class="section-header">
      <text class="section-title">{{searchKeyword ? 'æœç´¢ç»“æœ' : 'æ‰€æœ‰ç¬”è®°'}} ({{filteredNotes.length}})</text>
      <view class="sort-options">
        <picker mode="selector" range="{{sortOptions}}" value="{{sortIndex}}" bindchange="onSortChange">
          <view class="sort-btn">
            <text>{{sortOptions[sortIndex]}}</text>
            <text class="sort-arrow">â–¼</text>
          </view>
        </picker>
      </view>
    </view>
    
    <view class="notes-list">
      <view class="note-card" 
            wx:for="{{filteredNotes}}" 
            wx:key="id" 
            bindtap="openNote" 
            data-note="{{item}}">
        <view class="note-header">
          <text class="note-title">{{item.title}}</text>
          <view class="note-category-badge" style="background: {{getCategoryColor(item.category)}}">
            {{getCategoryName(item.category)}}
          </view>
        </view>
        
        <view class="note-content">
          <text class="note-text">{{item.content}}</text>
        </view>
        
        <view class="note-tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <text class="note-tag" wx:for="{{item.tags}}" wx:key="*this">#{{item}}</text>
        </view>
        
        <view class="note-footer">
          <text class="note-time">{{item.updateTime || item.createTime}}</text>
          <text class="note-word-count">{{item.wordCount}}å­—</text>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{filteredNotes.length === 0}}">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">{{searchKeyword ? 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç¬”è®°' : 'è¿˜æ²¡æœ‰ç¬”è®°ï¼Œå»åˆ›å»ºç¬¬ä¸€æ¡å§ï¼'}}</text>
        <button class="create-btn" bindtap="goToEditor">åˆ›å»ºç¬”è®°</button>
      </view>
    </view>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="floating-actions">
    <view class="floating-btn create-btn" bindtap="goToEditor">
      <text class="btn-icon">+</text>
    </view>
    <view class="floating-btn manage-btn" bindtap="showManageOptions">
      <text class="btn-icon">âš™ï¸</text>
    </view>
  </view>

  <!-- ç®¡ç†é€‰é¡¹å¼¹çª— -->
  <view class="manage-modal {{showManageModal ? 'show' : ''}}" bindtap="hideManageModal">
    <view class="modal-content" catchtap="stopPropagation">
      <text class="modal-title">æ•°æ®ç®¡ç†</text>
      <view class="modal-options">
        <view class="modal-option" bindtap="exportData">
          <text class="option-icon">ğŸ“¤</text>
          <text class="option-text">å¯¼å‡ºæ•°æ®</text>
        </view>
        <view class="modal-option" bindtap="importData">
          <text class="option-icon">ğŸ“¥</text>
          <text class="option-text">å¯¼å…¥æ•°æ®</text>
        </view>
        <view class="modal-option" bindtap="clearAllData">
          <text class="option-icon">ğŸ—‘ï¸</text>
          <text class="option-text">æ¸…ç©ºæ•°æ®</text>
        </view>
      </view>
      <button class="modal-close" bindtap="hideManageModal">å–æ¶ˆ</button>
    </view>
  </view>
</view>
