<!--pages/favorites/favorites.wxml-->
<view class="favorites-container">
  <!-- 顶部导航 -->
  <view class="nav-bar">
    <view class="nav-content">
      <view class="nav-left" bindtap="goBack">
        <text class="nav-icon">←</text>
      </view>
      <text class="nav-title">我的收藏</text>
      <view class="nav-right" bindtap="toggleBatchMode">
        <text class="nav-icon">{{isBatchMode ? '✓' : '☰'}}</text>
      </view>
    </view>
  </view>

  <!-- 统计信息卡片 -->
  <view class="stats-card">
    <view class="stat-item">
      <text class="stat-icon">⭐</text>
      <view class="stat-content">
        <text class="stat-value">{{totalCount}}</text>
        <text class="stat-label">收藏笔记</text>
      </view>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-icon">📝</text>
      <view class="stat-content">
        <text class="stat-value">{{totalWords}}</text>
        <text class="stat-label">总字数</text>
      </view>
    </view>
  </view>

  <!-- 搜索和筛选区域 -->
  <view class="filter-section">
    <!-- 搜索框 -->
    <view class="search-box">
      <text class="search-icon">🔍</text>
      <input class="search-input" 
             placeholder="搜索收藏笔记..." 
             value="{{searchKeyword}}"
             bindinput="onSearchInput"/>
    </view>

    <!-- 工具栏 -->
    <view class="toolbar">
      <picker class="tool-item" mode="selector" range="{{sortOptions}}" 
              value="{{sortIndex}}" bindchange="onSortChange">
        <view class="picker-box">
          <text class="tool-icon">📊</text>
          <text class="tool-text">{{sortOptions[sortIndex]}}</text>
        </view>
      </picker>
      
      <view class="tool-item" bindtap="toggleViewMode">
        <text class="tool-icon">{{viewMode === 'list' ? '▦' : '▤'}}</text>
        <text class="tool-text">{{viewMode === 'list' ? '网格' : '列表'}}</text>
      </view>
    </view>

    <!-- 分类筛选 -->
    <view class="category-filter">
      <scroll-view class="category-scroll" scroll-x>
        <view class="category-chip {{selectedCategory === '' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="">
          <text class="chip-text">全部</text>
        </view>
        <view class="category-chip {{selectedCategory === 'art' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="art">
          <text class="chip-text">艺术</text>
        </view>
        <view class="category-chip {{selectedCategory === 'cute' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="cute">
          <text class="chip-text">萌物</text>
        </view>
        <view class="category-chip {{selectedCategory === 'dreams' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="dreams">
          <text class="chip-text">梦游</text>
        </view>
        <view class="category-chip {{selectedCategory === 'foods' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="foods">
          <text class="chip-text">美食</text>
        </view>
        <view class="category-chip {{selectedCategory === 'happiness' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="happiness">
          <text class="chip-text">趣事</text>
        </view>
        <view class="category-chip {{selectedCategory === 'knowledge' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="knowledge">
          <text class="chip-text">知识</text>
        </view>
        <view class="category-chip {{selectedCategory === 'sights' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="sights">
          <text class="chip-text">风景</text>
        </view>
        <view class="category-chip {{selectedCategory === 'thinking' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="thinking">
          <text class="chip-text">思考</text>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- 批量操作栏 -->
  <view class="batch-toolbar" wx:if="{{isBatchMode}}">
    <view class="batch-info">
      <text class="batch-text">已选择 {{selectedNotes.length}} 条</text>
    </view>
    <view class="batch-actions">
      <button class="batch-btn" bindtap="batchUnfavorite">
        <text class="btn-icon">💔</text>
        <text class="btn-text">取消收藏</text>
      </button>
    </view>
  </view>

  <!-- 笔记列表 -->
  <view class="notes-section">
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{favoriteNotes.length === 0}}">
      <text class="empty-icon">⭐</text>
      <text class="empty-text">还没有收藏任何笔记</text>
      <text class="empty-hint">在笔记详情中点击收藏按钮添加收藏</text>
    </view>

    <!-- 列表视图 -->
    <view class="notes-list" wx:if="{{favoriteNotes.length > 0 && viewMode === 'list'}}">
      <view class="note-card {{item.isSelected ? 'selected' : ''}}" 
            wx:for="{{favoriteNotes}}" wx:key="id"
            bindtap="openNote" data-id="{{item.id}}">
        <!-- 批量选择标记 -->
        <view class="select-checkbox" wx:if="{{isBatchMode}}">
          <view class="checkbox {{item.isSelected ? 'checked' : ''}}">
            <text class="checkmark" wx:if="{{item.isSelected}}">✓</text>
          </view>
        </view>
        
        <view class="note-content">
          <view class="note-header">
            <text class="note-title">{{item.title}}</text>
            <view class="category-badge {{item.category}}">
              <text class="badge-text">{{getCategoryName(item.category)}}</text>
            </view>
          </view>
          
          <text class="note-preview">{{item.content}}</text>
          
          <view class="note-meta">
            <text class="meta-item">📅 {{item.createTime}}</text>
            <text class="meta-item">💭 {{item.wordCount || 0}}字</text>
            <text class="meta-item favorite-time">⭐ {{item.favoriteTime || item.createTime}}</text>
          </view>
          
          <view class="note-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <text class="tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">
              #{{tag}}
            </text>
          </view>
        </view>
        
        <view class="note-actions" wx:if="{{!isBatchMode}}" catchtap="unfavoriteNote" data-id="{{item.id}}">
          <text class="action-icon">💔</text>
        </view>
      </view>
    </view>

    <!-- 网格视图 -->
    <view class="notes-grid" wx:if="{{favoriteNotes.length > 0 && viewMode === 'grid'}}">
      <view class="note-grid-card {{item.isSelected ? 'selected' : ''}}" 
            wx:for="{{favoriteNotes}}" wx:key="id"
            bindtap="openNote" data-id="{{item.id}}">
        <view class="select-checkbox" wx:if="{{isBatchMode}}">
          <view class="checkbox {{item.isSelected ? 'checked' : ''}}">
            <text class="checkmark" wx:if="{{item.isSelected}}">✓</text>
          </view>
        </view>
        
        <view class="category-badge-small {{item.category}}">
          <text class="badge-text-small">{{getCategoryName(item.category)}}</text>
        </view>
        
        <text class="grid-note-title">{{item.title}}</text>
        <text class="grid-note-preview">{{item.content}}</text>
        
        <view class="grid-note-footer">
          <text class="grid-meta">{{item.wordCount || 0}}字</text>
          <text class="grid-favorite-icon">⭐</text>
        </view>
      </view>
    </view>
  </view>
</view>

