<!--pages/favorites/favorites.wxml-->
<view class="favorites-container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="nav-bar">
    <view class="nav-content">
      <view class="nav-left" bindtap="goBack">
        <text class="nav-icon">â†</text>
      </view>
      <text class="nav-title">æˆ‘çš„æ”¶è—</text>
      <view class="nav-right" bindtap="showSettings">
        <text class="nav-icon">âš™ï¸</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾æ  -->
  <view class="category-tabs">
    <view class="tab-item {{currentTab === 'all' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="all">
      <text class="tab-icon">â­</text>
      <text class="tab-text">å…¨éƒ¨</text>
      <text class="tab-count">{{totalCount}}</text>
    </view>
    <view class="tab-item {{currentTab === 'notes' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="notes">
      <text class="tab-icon">ğŸ“</text>
      <text class="tab-text">ç¬”è®°</text>
      <text class="tab-count">{{noteCount}}</text>
    </view>
    <view class="tab-item {{currentTab === 'knowledge' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="knowledge">
      <text class="tab-icon">ğŸŒŸ</text>
      <text class="tab-text">çŸ¥è¯†æ˜Ÿå›¾</text>
      <text class="tab-count">{{knowledgeCount}}</text>
    </view>
    <view class="tab-item {{currentTab === 'dreams' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="dreams">
      <text class="tab-icon">ğŸ’­</text>
      <text class="tab-text">æ¢¦å¢ƒ</text>
      <text class="tab-count">{{dreamCount}}</text>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰æ  -->
  <view class="search-filter-bar">
    <view class="search-container">
      <input class="search-input" 
             placeholder="æœç´¢æ”¶è—å†…å®¹..." 
             value="{{searchKeyword}}"
             bindinput="onSearchInput"
             bindconfirm="onSearchConfirm" />
      <text class="search-icon">ğŸ”</text>
    </view>
    <view class="filter-container">
      <view class="filter-btn" bindtap="showSortMenu">
        <text class="filter-text">{{sortOptions[sortIndex]}}</text>
        <text class="filter-arrow">â–¼</text>
      </view>
      <view class="view-mode-btn" bindtap="toggleViewMode">
        <text class="view-mode-icon">{{viewMode === 'list' ? 'â˜°' : 'âŠ'}}</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-header">
      <text class="stats-title">æ”¶è—ç»Ÿè®¡</text>
      <text class="stats-subtitle">æˆ‘çš„çŸ¥è¯†å®åº“</text>
    </view>
    <view class="stats-content">
      <view class="stat-item">
        <text class="stat-number">{{totalCount}}</text>
        <text class="stat-label">æ€»æ”¶è—</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{totalWords}}</text>
        <text class="stat-label">æ€»å­—æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{favoriteDays}}</text>
        <text class="stat-label">æ”¶è—å¤©æ•°</text>
      </view>
    </view>
  </view>

  <!-- æ”¶è—å†…å®¹åˆ—è¡¨ -->
  <view class="favorites-content">
    <!-- ç¬”è®°æ”¶è— -->
    <view class="favorites-section" wx:if="{{currentTab === 'all' || currentTab === 'notes'}}">
      <view class="section-header" wx:if="{{filteredNotes.length > 0}}">
        <text class="section-title">ğŸ“ æ”¶è—çš„ç¬”è®°</text>
        <text class="section-count">{{filteredNotes.length}}æ¡</text>
      </view>
      
      <!-- åˆ—è¡¨è§†å›¾ -->
      <view class="notes-list" wx:if="{{viewMode === 'list'}}">
        <view class="note-item" wx:for="{{filteredNotes}}" wx:key="id">
          <view class="note-content" bindtap="openNoteDetail" data-id="{{item.id}}">
            <view class="note-header">
              <text class="note-title">{{item.title}}</text>
              <text class="note-category">{{item.category}}</text>
            </view>
            <text class="note-preview">{{item.content}}</text>
            <view class="note-meta">
              <text class="note-time">{{item.favoriteTime}}</text>
              <text class="note-words">{{item.wordCount}}å­—</text>
            </view>
          </view>
          <view class="note-actions">
            <view class="action-btn" bindtap="removeFromFavorites" data-id="{{item.id}}" data-type="note">
              <text class="action-icon">ğŸ’”</text>
            </view>
            <view class="action-btn" bindtap="shareNote" data-id="{{item.id}}">
              <text class="action-icon">ğŸ“¤</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç½‘æ ¼è§†å›¾ -->
      <view class="notes-grid" wx:if="{{viewMode === 'grid'}}">
        <view class="note-card" wx:for="{{filteredNotes}}" wx:key="id" 
              bindtap="openNoteDetail" data-id="{{item.id}}">
          <view class="card-header">
            <text class="card-category">{{item.category}}</text>
            <view class="card-actions">
              <view class="card-action" bindtap="removeFromFavorites" data-id="{{item.id}}" data-type="note" catchtap="true">
                <text class="action-icon">ğŸ’”</text>
              </view>
            </view>
          </view>
          <text class="card-title">{{item.title}}</text>
          <text class="card-preview">{{item.content}}</text>
          <view class="card-footer">
            <text class="card-time">{{item.favoriteTime}}</text>
            <text class="card-words">{{item.wordCount}}å­—</text>
          </view>
        </view>
      </view>
    </view>

    <!-- çŸ¥è¯†æ˜Ÿå›¾æ”¶è— -->
    <view class="favorites-section" wx:if="{{currentTab === 'all' || currentTab === 'knowledge'}}">
      <view class="section-header" wx:if="{{filteredKnowledge.length > 0}}">
        <text class="section-title">ğŸŒŸ æ”¶è—çš„çŸ¥è¯†æ˜Ÿå›¾</text>
        <text class="section-count">{{filteredKnowledge.length}}ä¸ª</text>
      </view>
      
      <view class="knowledge-list">
        <view class="knowledge-item" wx:for="{{filteredKnowledge}}" wx:key="id">
          <view class="knowledge-preview" bindtap="openKnowledgeMap" data-id="{{item.id}}">
            <view class="preview-header">
              <text class="preview-title">{{item.name}}</text>
              <text class="preview-nodes">{{item.nodeCount}}ä¸ªèŠ‚ç‚¹</text>
            </view>
            <view class="preview-stats">
              <text class="stat-item">{{item.connectionCount}}æ¡å…³è”</text>
              <text class="stat-item">{{item.noteCount}}æ¡ç¬”è®°</text>
            </view>
            <text class="preview-time">{{item.favoriteTime}}</text>
          </view>
          <view class="knowledge-actions">
            <view class="action-btn" bindtap="removeFromFavorites" data-id="{{item.id}}" data-type="knowledge">
              <text class="action-icon">ğŸ’”</text>
            </view>
            <view class="action-btn" bindtap="shareKnowledge" data-id="{{item.id}}">
              <text class="action-icon">ğŸ“¤</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ¢¦å¢ƒæ”¶è— -->
    <view class="favorites-section" wx:if="{{currentTab === 'all' || currentTab === 'dreams'}}">
      <view class="section-header" wx:if="{{filteredDreams.length > 0}}">
        <text class="section-title">ğŸ’­ æ”¶è—çš„æ¢¦å¢ƒ</text>
        <text class="section-count">{{filteredDreams.length}}ä¸ª</text>
      </view>
      
      <view class="dreams-list">
        <view class="dream-item" wx:for="{{filteredDreams}}" wx:key="id">
          <view class="dream-content" bindtap="openDreamDetail" data-id="{{item.id}}">
            <view class="dream-header">
              <text class="dream-type">{{item.dreamType}}</text>
              <text class="dream-style">{{item.dreamStyle}}</text>
            </view>
            <text class="dream-preview">{{item.content}}</text>
            <view class="dream-meta">
              <text class="dream-time">{{item.favoriteTime}}</text>
              <text class="dream-length">{{item.content.length}}å­—</text>
            </view>
          </view>
          <view class="dream-actions">
            <view class="action-btn" bindtap="removeFromFavorites" data-id="{{item.id}}" data-type="dream">
              <text class="action-icon">ğŸ’”</text>
            </view>
            <view class="action-btn" bindtap="shareDream" data-id="{{item.id}}">
              <text class="action-icon">ğŸ“¤</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{isEmpty}}">
    <text class="empty-icon">â­</text>
    <text class="empty-title">æš‚æ— æ”¶è—å†…å®¹</text>
    <text class="empty-desc">å¼€å§‹æ”¶è—ä½ å–œæ¬¢çš„ç¬”è®°ã€çŸ¥è¯†æ˜Ÿå›¾å’Œæ¢¦å¢ƒå§</text>
    <button class="empty-btn" bindtap="goToHome">å»é¦–é¡µçœ‹çœ‹</button>
  </view>

  <!-- æ‰¹é‡æ“ä½œæ  -->
  <view class="batch-actions" wx:if="{{isBatchMode}}">
    <view class="batch-info">
      <text class="batch-text">å·²é€‰æ‹© {{selectedItems.length}} é¡¹</text>
    </view>
    <view class="batch-buttons">
      <button class="batch-btn cancel-btn" bindtap="cancelBatch">å–æ¶ˆ</button>
      <button class="batch-btn delete-btn" bindtap="batchDelete">åˆ é™¤</button>
    </view>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="floating-actions">
    <view class="floating-btn batch-btn" bindtap="toggleBatchMode">
      <text class="floating-icon">â˜‘ï¸</text>
    </view>
    <view class="floating-btn add-btn" bindtap="showAddMenu">
      <text class="floating-icon">â•</text>
    </view>
  </view>
</view>