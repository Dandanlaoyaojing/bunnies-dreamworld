<!--pages/draft-box/draft-box.wxml-->
<view class="draft-box-container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="nav-bar">
    <view class="nav-content">
      <view class="nav-left" bindtap="goBack">
        <text class="nav-icon">â†</text>
      </view>
      <text class="nav-title">è‰ç¨¿ç®±</text>
      <view class="nav-right">
        <text class="nav-icon" bindtap="createNewDraft">âœï¸</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
  <view class="stats-card" wx:if="{{!isEmpty}}">
    <view class="stats-header">
      <text class="stats-title">ğŸ“Š è‰ç¨¿ç»Ÿè®¡</text>
      <text class="stats-count">å…± {{stats.totalCount}} ä¸ªè‰ç¨¿</text>
    </view>
    <view class="stats-content">
      <view class="stat-item">
        <text class="stat-label">æœ€æ–°è‰ç¨¿</text>
        <text class="stat-value">{{stats.newestDraft ? stats.newestDraft.updateTimeFormatted : 'æ— '}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">æœ€æ—©è‰ç¨¿</text>
        <text class="stat-value">{{stats.oldestDraft ? stats.oldestDraft.createTimeFormatted : 'æ— '}}</text>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åºå·¥å…·æ  -->
  <view class="toolbar" wx:if="{{!isEmpty}}">
    <!-- æœç´¢æ¡† -->
    <view class="search-section">
      <view class="search-box">
        <text class="search-icon">ğŸ”</text>
        <input class="search-input" placeholder="æœç´¢è‰ç¨¿..." 
               value="{{searchKeyword}}" bindinput="onSearchInput"/>
      </view>
    </view>

    <!-- åˆ†ç±»ç­›é€‰ -->
    <view class="filter-section">
      <scroll-view class="category-scroll" scroll-x="true">
        <view class="category-list">
          <view class="category-item {{filterCategory === item.key ? 'active' : ''}}"
                wx:for="{{categories}}" wx:key="key"
                bindtap="selectCategory" data-category="{{item.key}}">
            <text class="category-icon">{{item.icon}}</text>
            <text class="category-name">{{item.name}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- æ’åºå’Œæ“ä½œ -->
    <view class="action-section">
      <view class="sort-controls">
        <picker class="sort-picker" range="{{['æ›´æ–°æ—¶é—´', 'åˆ›å»ºæ—¶é—´', 'æ ‡é¢˜', 'åˆ†ç±»']}}" 
                range-key="name" value="{{sortBy === 'updateTime' ? 0 : sortBy === 'createTime' ? 1 : sortBy === 'title' ? 2 : 3}}"
                bindchange="selectSortBy">
          <view class="sort-display">
            <text class="sort-text">æ’åº: {{sortBy === 'updateTime' ? 'æ›´æ–°æ—¶é—´' : sortBy === 'createTime' ? 'åˆ›å»ºæ—¶é—´' : sortBy === 'title' ? 'æ ‡é¢˜' : 'åˆ†ç±»'}}</text>
            <text class="sort-icon">{{sortOrder === 'desc' ? 'â†“' : 'â†‘'}}</text>
          </view>
        </picker>
        <view class="sort-toggle" bindtap="toggleSortOrder">
          <text class="toggle-icon">{{sortOrder === 'desc' ? 'â†“' : 'â†‘'}}</text>
        </view>
      </view>
      
      <view class="batch-controls">
        <button class="batch-btn" bindtap="toggleBatchMode">
          <text class="btn-text">{{isBatchMode ? 'å–æ¶ˆæ‰¹é‡' : 'æ‰¹é‡æ“ä½œ'}}</text>
        </button>
        <button class="clear-btn" bindtap="clearAllDrafts">
          <text class="btn-text">æ¸…ç©º</text>
        </button>
      </view>
    </view>
  </view>

  <!-- æ‰¹é‡æ“ä½œæ  -->
  <view class="batch-toolbar" wx:if="{{isBatchMode}}">
    <view class="batch-info">
      <text class="batch-text">å·²é€‰æ‹© {{selectedDrafts.length}} ä¸ªè‰ç¨¿</text>
    </view>
    <view class="batch-actions">
      <button class="batch-action-btn select-all-btn" bindtap="toggleSelectAll">
        <text class="btn-text">{{selectedDrafts.length === drafts.length ? 'å…¨ä¸é€‰' : 'å…¨é€‰'}}</text>
      </button>
      <button class="batch-action-btn publish-btn" bindtap="batchPublish">
        <text class="btn-text">æ‰¹é‡å‘å¸ƒ</text>
      </button>
      <button class="batch-action-btn delete-btn" bindtap="batchDelete">
        <text class="btn-text">æ‰¹é‡åˆ é™¤</text>
      </button>
    </view>
  </view>

  <!-- è‰ç¨¿åˆ—è¡¨ -->
  <view class="drafts-list" wx:if="{{!isEmpty}}">
    <view class="draft-item {{selectedDrafts.indexOf(item.id) > -1 ? 'selected' : ''}}"
          wx:for="{{drafts}}" wx:key="id"
          bindtap="onDraftTap" bindlongpress="onDraftLongPress"
          data-id="{{item.id}}">
      
      <!-- é€‰æ‹©æ¡† -->
      <view class="selection-box" wx:if="{{isBatchMode}}">
        <view class="checkbox {{selectedDrafts.indexOf(item.id) > -1 ? 'checked' : ''}}">
          <text class="checkmark" wx:if="{{selectedDrafts.indexOf(item.id) > -1}}">âœ“</text>
        </view>
      </view>

      <!-- è‰ç¨¿å†…å®¹ -->
      <view class="draft-content">
        <view class="draft-header">
          <text class="draft-title">{{item.title}}</text>
          <view class="draft-meta">
            <text class="draft-category">{{item.category}}</text>
            <text class="draft-time">{{item.updateTimeFormatted}}</text>
          </view>
        </view>
        
        <view class="draft-preview">
          <text class="preview-text">{{item.preview}}</text>
        </view>
        
        <view class="draft-footer">
          <view class="draft-stats">
            <text class="word-count">{{item.wordCount}} å­—</text>
            <text class="create-time">åˆ›å»ºäº {{item.createTimeFormatted}}</text>
          </view>
          
          <!-- æ“ä½œæŒ‰é’® -->
          <view class="draft-actions" wx:if="{{!isBatchMode}}">
            <button class="action-btn edit-btn" bindtap="editDraft" data-id="{{item.id}}" catchtap="true">
              <text class="btn-icon">âœï¸</text>
            </button>
            <button class="action-btn publish-btn" bindtap="publishDraft" data-id="{{item.id}}" catchtap="true">
              <text class="btn-icon">ğŸ“¤</text>
            </button>
            <button class="action-btn delete-btn" bindtap="deleteDraft" data-id="{{item.id}}" catchtap="true">
              <text class="btn-icon">ğŸ—‘ï¸</text>
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{isEmpty}}">
    <view class="empty-animation">
      <text class="empty-icon">ğŸ“</text>
      <view class="floating-dots">
        <text class="dot">Â·</text>
        <text class="dot">Â·</text>
        <text class="dot">Â·</text>
      </view>
    </view>
    <view class="empty-content">
      <text class="empty-title">è‰ç¨¿ç®±ç©ºç©ºå¦‚ä¹Ÿ</text>
      <text class="empty-subtitle">è¿˜æ²¡æœ‰ä¿å­˜ä»»ä½•è‰ç¨¿ï¼Œå¼€å§‹åˆ›ä½œä½ çš„ç¬¬ä¸€ç¯‡ç¬”è®°å§ï¼</text>
    </view>
    <view class="empty-actions">
      <button class="create-btn" bindtap="createNewDraft">
        <text class="btn-icon">âœï¸</text>
        <text class="btn-text">åˆ›å»ºæ–°è‰ç¨¿</text>
      </button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <view class="loading-animation">
      <text class="loading-icon">ğŸ“</text>
      <view class="loading-dots">
        <text class="dot">Â·</text>
        <text class="dot">Â·</text>
        <text class="dot">Â·</text>
      </view>
    </view>
    <text class="loading-text">æ­£åœ¨åŠ è½½è‰ç¨¿...</text>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area"></view>
</view>
