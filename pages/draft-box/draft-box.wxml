<!--pages/draft-box/draft-box.wxml-->
<view class="draft-box-container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="nav-bar">
    <view class="nav-content">
      <view class="nav-left" bindtap="goBack">
        <text class="nav-icon">â†</text>
      </view>
      <text class="nav-title">è‰ç¨¿ç®±</text>
      <view class="nav-right" bindtap="createNewDraft">
        <text class="nav-icon">âœï¸</text>
      </view>
    </view>
  </view>

  <!-- æ¢¦å¢ƒç»Ÿè®¡å¡ç‰‡ -->
  <view class="dream-stats-card" wx:if="{{!isEmpty}}">
    <view class="stats-header">
      <text class="stats-title">ğŸ“Š è‰ç¨¿ç»Ÿè®¡</text>
      <view class="stats-badge">
        <text class="stats-count">{{stats.totalCount}}</text>
        <text class="stats-unit">ä¸ªè‰ç¨¿</text>
      </view>
    </view>
    <view class="stats-content">
      <view class="stat-item">
        <text class="stat-icon">ğŸ•</text>
        <view class="stat-info">
          <text class="stat-label">æœ€æ–°è‰ç¨¿</text>
          <text class="stat-value">{{stats.newestDraft ? stats.newestDraft.updateTimeFormatted : 'æ— '}}</text>
        </view>
      </view>
      <view class="stat-item">
        <text class="stat-icon">ğŸŒŸ</text>
        <view class="stat-info">
          <text class="stat-label">æœ€æ—©è‰ç¨¿</text>
          <text class="stat-value">{{stats.oldestDraft ? stats.oldestDraft.createTimeFormatted : 'æ— '}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¢¦å¢ƒæœç´¢ä¸ç­›é€‰ -->
  <view class="dream-search-section" wx:if="{{!isEmpty}}">
    <!-- æœç´¢æ¡† -->
    <view class="search-container">
      <view class="search-box">
        <text class="search-icon">ğŸ”</text>
        <input class="search-input" placeholder="æœç´¢è‰ç¨¿å†…å®¹..." 
               value="{{searchKeyword}}" bindinput="onSearchInput"/>
        <view class="search-clear" wx:if="{{searchKeyword}}" bindtap="clearSearch">
          <text class="clear-icon">âœ•</text>
        </view>
      </view>
    </view>

    <!-- æ¢¦å¢ƒåˆ†ç±»ç­›é€‰ -->
    <view class="category-filter">
      <scroll-view class="category-scroll" scroll-x="true">
        <view class="category-list">
          <view class="category-item {{filterCategory === item.key ? 'active' : ''}}"
                wx:for="{{categories}}" wx:key="key"
                bindtap="selectCategory" data-category="{{item.key}}">
            <text class="category-icon">{{item.icon}}</text>
            <text class="category-name">{{item.name}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- æ“ä½œå·¥å…·æ  -->
    <view class="action-toolbar">
      <view class="toolbar-left">
        <view class="sort-selector" bindtap="showSortOptions">
          <text class="sort-icon">ğŸ“Š</text>
          <text class="sort-text">{{sortBy === 'updateTime' ? 'æ›´æ–°æ—¶é—´' : sortBy === 'createTime' ? 'åˆ›å»ºæ—¶é—´' : sortBy === 'title' ? 'æ ‡é¢˜' : 'åˆ†ç±»'}}</text>
          <text class="sort-arrow">{{sortOrder === 'desc' ? 'â†“' : 'â†‘'}}</text>
        </view>
      </view>
      <view class="toolbar-right">
        <view class="action-btn cloud-sync-btn" bindtap="syncDraftsFromCloud">
          <text class="btn-icon">â˜ï¸</text>
          <text class="btn-text">äº‘ç«¯åŒæ­¥</text>
        </view>
        <view class="action-btn batch-btn" bindtap="toggleBatchMode">
          <text class="btn-icon">ğŸ“‹</text>
          <text class="btn-text">{{isBatchMode ? 'å–æ¶ˆæ‰¹é‡' : 'æ‰¹é‡æ“ä½œ'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ‰¹é‡æ“ä½œæ  -->
  <view class="batch-toolbar" wx:if="{{isBatchMode}}">
    <view class="batch-info">
      <text class="batch-text">å·²é€‰æ‹© {{selectedDrafts.length}} ä¸ªè‰ç¨¿</text>
    </view>
    <view class="batch-actions">
      <view class="batch-btn select-all" bindtap="toggleSelectAll">
        <text class="btn-text">{{selectedDrafts.length === drafts.length ? 'å…¨ä¸é€‰' : 'å…¨é€‰'}}</text>
      </view>
      <view class="batch-btn cloud-save" bindtap="batchSaveToCloud">
        <text class="btn-text">æ‰¹é‡äº‘ç«¯ä¿å­˜</text>
      </view>
      <view class="batch-btn publish" bindtap="batchPublish">
        <text class="btn-text">æ‰¹é‡å‘å¸ƒ</text>
      </view>
      <view class="batch-btn delete" bindtap="batchDelete">
        <text class="btn-text">æ‰¹é‡åˆ é™¤</text>
      </view>
    </view>
  </view>

  <!-- æ¢¦å¢ƒåˆ—è¡¨ -->
  <view class="dreams-list" wx:if="{{!isEmpty}}">
    <view class="dream-item {{selectedDrafts.indexOf(item.id) > -1 ? 'selected' : ''}}"
          wx:for="{{drafts}}" wx:key="id"
          bindtap="onDraftTap" bindlongpress="onDraftLongPress"
          data-id="{{item.id}}">
      
      <!-- é€‰æ‹©æ¡† -->
      <view class="selection-box" wx:if="{{isBatchMode}}">
        <view class="checkbox {{selectedDrafts.indexOf(item.id) > -1 ? 'checked' : ''}}">
          <text class="checkmark" wx:if="{{selectedDrafts.indexOf(item.id) > -1}}">âœ“</text>
        </view>
      </view>

      <!-- æ¢¦å¢ƒå†…å®¹ -->
      <view class="dream-content">
        <view class="dream-header">
          <view class="dream-title-section">
            <text class="dream-title">{{item.title}}</text>
            <view class="dream-meta">
              <text class="dream-category">{{item.category}}</text>
              <text class="dream-time">{{item.updateTimeFormatted}}</text>
            </view>
          </view>
          <view class="dream-status">
            <text class="status-icon" wx:if="{{item.cloudId}}">â˜ï¸</text>
            <text class="status-icon" wx:else>ğŸ“±</text>
          </view>
        </view>
        
        <view class="dream-preview">
          <text class="preview-text">{{item.preview}}</text>
        </view>
        
        <view class="dream-footer">
          <view class="dream-stats">
            <text class="word-count">{{item.wordCount}} å­—</text>
            <text class="create-time">åˆ›å»ºäº {{item.createTimeFormatted}}</text>
          </view>
          
          <!-- æ“ä½œæŒ‰é’® -->
          <view class="dream-actions" wx:if="{{!isBatchMode}}">
            <view class="action-btn edit" bindtap="editDraft" data-id="{{item.id}}" catchtap="stopPropagation">
              <text class="btn-icon">âœï¸</text>
            </view>
            <view class="action-btn cloud-save" bindtap="saveDraftToCloud" data-id="{{item.id}}" catchtap="stopPropagation">
              <text class="btn-icon">â˜ï¸</text>
            </view>
            <view class="action-btn publish" bindtap="publishDraft" data-id="{{item.id}}" catchtap="stopPropagation">
              <text class="btn-icon">ğŸ“¤</text>
            </view>
            <view class="action-btn delete" bindtap="deleteDraft" data-id="{{item.id}}" catchtap="stopPropagation">
              <text class="btn-icon">ğŸ—‘ï¸</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-dream-state" wx:if="{{isEmpty}}">
    <view class="empty-animation">
      <text class="empty-icon">ğŸ“</text>
      <view class="floating-stars">
        <text class="star">âœ¨</text>
        <text class="star">â­</text>
        <text class="star">ğŸŒŸ</text>
      </view>
    </view>
    <view class="empty-content">
      <text class="empty-title">è‰ç¨¿ç®±ç©ºç©ºå¦‚ä¹Ÿ</text>
      <text class="empty-subtitle">è¿˜æ²¡æœ‰ä¿å­˜ä»»ä½•è‰ç¨¿ï¼Œå¼€å§‹åˆ›ä½œä½ çš„ç¬¬ä¸€ç¯‡ç¬”è®°å§ï¼</text>
    </view>
    <view class="empty-actions">
      <view class="create-dream-btn" bindtap="createNewDraft">
        <text class="btn-icon">âœï¸</text>
        <text class="btn-text">åˆ›å»ºæ–°è‰ç¨¿</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-dream-state" wx:if="{{isLoading}}">
    <view class="loading-animation">
      <text class="loading-icon">ğŸ“</text>
      <view class="loading-stars">
        <text class="star">âœ¨</text>
        <text class="star">â­</text>
        <text class="star">ğŸŒŸ</text>
      </view>
    </view>
    <text class="loading-text">æ­£åœ¨åŠ è½½è‰ç¨¿...</text>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area"></view>
</view>