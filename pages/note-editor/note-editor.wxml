<!--pages/note-editor/note-editor.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨åŒºåŸŸ -->
  <view class="header">
    <input class="title-input" placeholder="è¾“å…¥ç¬”è®°æ ‡é¢˜..." value="{{noteTitle}}" bindinput="onTitleInput" />
    <input class="url-input" placeholder="è¾“å…¥ç›¸å…³é“¾æ¥ (å¯é€‰)..." value="{{noteUrl}}" bindinput="onUrlInput" />
  </view>
  
  <!-- åˆ†ç±»é€‰æ‹©åŒºåŸŸ -->
  <view class="category-section">
    <text class="section-title">é€‰æ‹©åˆ†ç±»</text>
    <view class="categories">
      <view class="category-item {{selectedCategory === 'art' ? 'selected' : ''}}" 
            bindtap="selectCategory" data-category="art">
        <image src="/images/menu/art.png" class="category-icon" />
        <text class="category-name">è‰ºæœ¯</text>
      </view>
      <view class="category-item {{selectedCategory === 'cute' ? 'selected' : ''}}" 
            bindtap="selectCategory" data-category="cute">
        <image src="/images/menu/cute.png" class="category-icon" />
        <text class="category-name">èŒç‰©</text>
      </view>
      <view class="category-item {{selectedCategory === 'dreams' ? 'selected' : ''}}" 
            bindtap="selectCategory" data-category="dreams">
        <image src="/images/menu/dreams.png" class="category-icon" />
        <text class="category-name">æ¢¦æ¸¸</text>
      </view>
      <view class="category-item {{selectedCategory === 'foods' ? 'selected' : ''}}" 
            bindtap="selectCategory" data-category="foods">
        <image src="/images/menu/foods.png" class="category-icon" />
        <text class="category-name">ç¾é£Ÿ</text>
      </view>
      <view class="category-item {{selectedCategory === 'happiness' ? 'selected' : ''}}" 
            bindtap="selectCategory" data-category="happiness">
        <image src="/images/menu/happiness.png" class="category-icon" />
        <text class="category-name">è¶£äº‹</text>
      </view>
      <view class="category-item {{selectedCategory === 'knowledge' ? 'selected' : ''}}" 
            bindtap="selectCategory" data-category="knowledge">
        <image src="/images/menu/knowledge.png" class="category-icon" />
        <text class="category-name">çŸ¥è¯†</text>
      </view>
      <view class="category-item {{selectedCategory === 'sights' ? 'selected' : ''}}" 
            bindtap="selectCategory" data-category="sights">
        <image src="/images/menu/sights.png" class="category-icon" />
        <text class="category-name">é£æ™¯</text>
      </view>
      <view class="category-item {{selectedCategory === 'thinking' ? 'selected' : ''}}" 
            bindtap="selectCategory" data-category="thinking">
        <image src="/images/menu/thinking.png" class="category-icon" />
        <text class="category-name">æ€è€ƒ</text>
      </view>
    </view>
  </view>
  
  <!-- æ ¸å¿ƒç¼–è¾‘åŒº -->
  <view class="editor-container">
    <textarea class="main-editor" 
              placeholder="åœ¨è¿™é‡Œè®°å½•ä½ çš„æƒ³æ³•..." 
              value="{{noteContent}}" 
              bindinput="onContentInput"
              auto-height="{{true}}"
              maxlength="5000">
    </textarea>
  </view>
  
  <!-- åŠŸèƒ½å·¥å…·æ  -->
  <view class="toolbar">
    <view class="toolbar-row">
      <view class="tool-item image-btn" bindtap="chooseImage">
        <image src="/images/notes/camera.png" class="tool-icon" />
        <text class="tool-text">å›¾ç‰‡</text>
      </view>
      <view class="tool-item voice-btn" bindtap="startVoiceRecording" wx:if="{{!isRecording}}">
        <image src="/images/notes/phone.png" class="tool-icon" />
        <text class="tool-text">è¯­éŸ³</text>
      </view>
      <view class="tool-item stop-btn" bindtap="stopRecording" wx:if="{{isRecording}}">
        <image src="/images/notes/phone.png" class="tool-icon" />
        <text class="tool-text">åœæ­¢</text>
      </view>
      <view class="tool-item test-btn" bindtap="testRecordPermission">
        <image src="/images/notes/dics.png" class="tool-icon" />
        <text class="tool-text">æµ‹è¯•</text>
      </view>
      <view class="tool-item api-btn" bindtap="testBaiduAPI">
        <image src="/images/notes/dics.png" class="tool-icon" />
        <text class="tool-text">API</text>
      </view>
      <view class="tool-item model-btn" bindtap="showAIModelInfo">
        <image src="/images/notes/dics.png" class="tool-icon" />
        <text class="tool-text">æ¨¡å‹</text>
      </view>
      <view class="tool-item save-btn" bindtap="saveNote">
        <image src="/images/notes/dics.png" class="tool-icon" />
        <text class="tool-text">ä¿å­˜</text>
      </view>
    </view>
  </view>
  
  <!-- è¯­éŸ³æ¡åŒºåŸŸ -->
  <view class="voices-section" wx:if="{{voices.length > 0}}">
    <view class="section-header">
      <text class="section-title">è¯­éŸ³æ¡</text>
    </view>
    
    <view class="voices-list">
      <view class="voice-item" wx:for="{{voices}}" wx:key="id">
        <view class="voice-container">
          <view class="voice-info">
            <view class="voice-icon">ğŸ¤</view>
            <view class="voice-details">
              <text class="voice-duration">{{item.duration}}s</text>
              <text class="voice-time">{{item.createTime}}</text>
            </view>
          </view>
          
          <view class="voice-actions">
            <view class="action-btn play-btn" bindtap="playVoice" catchtap="playVoice" data-id="{{item.id}}">
              <text class="btn-icon">â–¶ï¸</text>
            </view>
            <view class="action-btn convert-btn" bindtap="convertVoiceToText" catchtap="convertVoiceToText" data-id="{{item.id}}">
              <text class="btn-icon">ğŸ“</text>
            </view>
            <view class="action-btn delete-btn" bindtap="deleteVoice" catchtap="deleteVoice" data-id="{{item.id}}">
              <text class="btn-icon">ğŸ—‘</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å›¾ç‰‡åŒºåŸŸ -->
  <view class="images-section" wx:if="{{images.length > 0}}">
    <view class="section-header">
      <text class="section-title">å›¾ç‰‡</text>
    </view>
    
    <view class="images-grid">
      <view class="image-item" wx:for="{{images}}" wx:key="id">
        <view class="image-container" bindtap="previewImage" data-src="{{item.path}}">
          <image class="image-preview" src="{{item.path}}" mode="aspectFill" />
          <view class="image-overlay">
            <view class="image-info">
              <text class="image-size">{{item.width}}Ã—{{item.height}}</text>
              <text class="image-time">{{item.createTime}}</text>
            </view>
            <view class="upload-status" wx:if="{{item.uploaded}}">
              <text class="status-text">å·²ä¸Šä¼ </text>
            </view>
          </view>
        </view>
        
        <view class="image-actions">
          <view class="action-btn delete-btn" bindtap="deleteImage" data-id="{{item.id}}">
            <text class="btn-icon">ğŸ—‘</text>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- æ™ºèƒ½æ ‡ç­¾åŒº -->
  <view class="tags-section">
    <view class="section-header">
      <text class="section-title">æ™ºèƒ½æ ‡ç­¾</text>
      <view class="section-actions">
        <view class="action-btn refresh-tags-btn" bindtap="generateSmartTags">
          <text class="btn-text">ç»§ç»­ç”Ÿæˆ</text>
        </view>
        <view class="action-btn clear-tags-btn" bindtap="clearAllTags" wx:if="{{tags.length > 0}}">
          <text class="btn-text">æ¸…ç©º</text>
        </view>
      </view>
    </view>
    
    <view class="tags-container" wx:if="{{tags.length > 0}}">
      <view class="tag" wx:for="{{tags}}" wx:key="*this" bindtap="removeTag" data-tag="{{item}}">
        #{{item}}
        <text class="tag-remove">Ã—</text>
      </view>
    </view>
    
    <view class="tags-empty" wx:if="{{tags.length === 0}}">
      <text class="empty-text">æš‚æ— æ ‡ç­¾ï¼Œç‚¹å‡»"AIç”Ÿæˆ"æˆ–"æ‰‹åŠ¨æ·»åŠ "å¼€å§‹</text>
    </view>
    
    <view class="tags-actions">
      <view class="add-tag" bindtap="addTag">
        <text class="add-tag-text">+ æ‰‹åŠ¨æ·»åŠ </text>
      </view>
    </view>
  </view>
  
  <!-- åº•éƒ¨çŠ¶æ€æ  -->
  <view class="status-bar">
    <view class="status-item">
      <text class="status-text">å­—æ•°: {{wordCount}}</text>
    </view>
    <view class="status-item">
      <text class="status-text">{{createTime}}</text>
    </view>
    <view class="status-item">
      <text class="status-text sync-status {{isSynced ? 'synced' : 'unsynced'}}">
        {{isSynced ? 'å·²åŒæ­¥' : 'æœªåŒæ­¥'}}
      </text>
    </view>
  </view>
</view>
