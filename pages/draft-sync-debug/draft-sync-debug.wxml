<!--pages/draft-sync-debug/draft-sync-debug.wxml - 草稿同步调试工具-->
<view class="container">
  <view class="header">
    <text class="title">草稿同步调试工具</text>
    <text class="subtitle">诊断草稿同步和forEach错误问题</text>
  </view>

  <!-- 测试按钮 -->
  <view class="test-buttons">
    <button 
      class="test-btn primary" 
      bindtap="testAPIGetDrafts"
      disabled="{{isLoading}}"
    >
      {{isLoading ? '测试中...' : '测试API服务获取草稿'}}
    </button>
    
    <button 
      class="test-btn secondary" 
      bindtap="testDownloadDrafts"
      disabled="{{isLoading}}"
    >
      {{isLoading ? '测试中...' : '测试草稿下载'}}
    </button>
    
    <button 
      class="test-btn secondary" 
      bindtap="testSyncDrafts"
      disabled="{{isLoading}}"
    >
      {{isLoading ? '测试中...' : '测试草稿同步'}}
    </button>
    
    <button 
      class="test-btn tertiary" 
      bindtap="checkLocalDrafts"
      disabled="{{isLoading}}"
    >
      {{isLoading ? '测试中...' : '检查本地草稿'}}
    </button>
    
    <button 
      class="test-btn clear" 
      bindtap="clearResult"
      disabled="{{isLoading}}"
    >
      清空结果
    </button>
  </view>

  <!-- 测试结果 -->
  <view class="result-container" wx:if="{{testResult}}">
    <view class="result-header">
      <text class="result-title">测试结果</text>
    </view>
    <view class="result-content">
      <text class="result-text">{{testResult}}</text>
    </view>
  </view>

  <!-- 问题分析 -->
  <view class="analysis-section">
    <text class="section-title">问题分析</text>
    
    <view class="analysis-item">
      <text class="analysis-title">🔍 forEach错误原因</text>
      <text class="analysis-desc">• cloudDrafts不是数组类型</text>
      <text class="analysis-desc">• 后端返回的数据格式不正确</text>
      <text class="analysis-desc">• API响应解析出现问题</text>
      <text class="analysis-desc">• 数据类型检查不够严格</text>
    </view>
    
    <view class="analysis-item">
      <text class="analysis-title">📋 调试步骤</text>
      <text class="analysis-desc">1. 测试API服务获取草稿 - 检查后端响应</text>
      <text class="analysis-desc">2. 测试草稿下载 - 检查下载逻辑</text>
      <text class="analysis-desc">3. 测试草稿同步 - 检查同步流程</text>
      <text class="analysis-desc">4. 检查本地草稿 - 检查本地数据</text>
    </view>
    
    <view class="analysis-item">
      <text class="analysis-title">💡 解决方案</text>
      <text class="analysis-desc">• 添加数据类型检查</text>
      <text class="analysis-desc">• 确保返回数组格式</text>
      <text class="analysis-desc">• 添加详细的调试日志</text>
      <text class="analysis-desc">• 处理异常情况</text>
    </view>
    
    <view class="analysis-item">
      <text class="analysis-title">🔧 修复内容</text>
      <text class="analysis-desc">• 在downloadDrafts中添加数组检查</text>
      <text class="analysis-desc">• 在syncDraftsFromCloud中添加类型验证</text>
      <text class="analysis-desc">• 添加详细的调试日志</text>
      <text class="analysis-desc">• 提供错误处理和降级方案</text>
    </view>
  </view>
</view>
