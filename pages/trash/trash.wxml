<!--pages/trash/trash.wxml-->
<view class="trash-container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="nav-bar">
    <view class="nav-content">
      <view class="nav-left" bindtap="goBack">
        <text class="nav-icon">â†</text>
      </view>
      <text class="nav-title">å›æ”¶ç«™</text>
      <view class="nav-right" bindtap="toggleBatchMode">
        <text class="nav-icon">{{isBatchMode ? 'âœ“' : 'â˜°'}}</text>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·ä¿¡æ¯æç¤º -->
  <view class="user-info-banner">
    <text class="user-icon">ğŸ‘¤</text>
    <text class="user-text">å½“å‰è´¦æˆ·ï¼š{{currentUser}}</text>
  </view>

  <!-- è­¦å‘Šæç¤º -->
  <view class="warning-banner">
    <text class="warning-icon">âš ï¸</text>
    <text class="warning-text">ç¬”è®°å°†åœ¨å›æ”¶ç«™ä¿ç•™ {{autoDeleteDays}} å¤©åè‡ªåŠ¨åˆ é™¤</text>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stat-item">
      <text class="stat-icon">ğŸ—‘ï¸</text>
      <view class="stat-content">
        <text class="stat-value">{{totalCount}}</text>
        <text class="stat-label">å·²åˆ é™¤ç¬”è®°</text>
      </view>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-icon">ğŸ“</text>
      <view class="stat-content">
        <text class="stat-value">{{totalWords}}</text>
        <text class="stat-label">æ€»å­—æ•°</text>
      </view>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-action" bindtap="emptyTrash">
      <text class="action-icon">ğŸ”¥</text>
      <text class="action-text">æ¸…ç©º</text>
    </view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰åŒºåŸŸ -->
  <view class="filter-section">
    <!-- æœç´¢æ¡† -->
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input" 
             placeholder="æœç´¢å·²åˆ é™¤ç¬”è®°..." 
             value="{{searchKeyword}}"
             bindinput="onSearchInput"/>
    </view>

    <!-- å·¥å…·æ  -->
    <view class="toolbar">
      <picker class="tool-item" mode="selector" range="{{sortOptions}}" 
              value="{{sortIndex}}" bindchange="onSortChange">
        <view class="picker-box">
          <text class="tool-icon">ğŸ“Š</text>
          <text class="tool-text">{{sortOptions[sortIndex]}}</text>
        </view>
      </picker>
      
      <view class="tool-item" bindtap="toggleViewMode">
        <text class="tool-icon">{{viewMode === 'list' ? 'â–¦' : 'â–¤'}}</text>
        <text class="tool-text">{{viewMode === 'list' ? 'ç½‘æ ¼' : 'åˆ—è¡¨'}}</text>
      </view>
    </view>

    <!-- åˆ†ç±»ç­›é€‰ -->
    <view class="category-filter">
      <scroll-view class="category-scroll" scroll-x>
        <view class="category-chip {{selectedCategory === '' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="">
          <text class="chip-text">å…¨éƒ¨</text>
        </view>
        <view class="category-chip {{selectedCategory === 'art' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="art">
          <text class="chip-text">è‰ºæœ¯</text>
        </view>
        <view class="category-chip {{selectedCategory === 'cute' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="cute">
          <text class="chip-text">èŒç‰©</text>
        </view>
        <view class="category-chip {{selectedCategory === 'dreams' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="dreams">
          <text class="chip-text">æ¢¦æ¸¸</text>
        </view>
        <view class="category-chip {{selectedCategory === 'foods' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="foods">
          <text class="chip-text">ç¾é£Ÿ</text>
        </view>
        <view class="category-chip {{selectedCategory === 'happiness' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="happiness">
          <text class="chip-text">è¶£äº‹</text>
        </view>
        <view class="category-chip {{selectedCategory === 'knowledge' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="knowledge">
          <text class="chip-text">çŸ¥è¯†</text>
        </view>
        <view class="category-chip {{selectedCategory === 'sights' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="sights">
          <text class="chip-text">é£æ™¯</text>
        </view>
        <view class="category-chip {{selectedCategory === 'thinking' ? 'active' : ''}}" 
              bindtap="filterByCategory" data-category="thinking">
          <text class="chip-text">æ€è€ƒ</text>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- æ‰¹é‡æ“ä½œæ  -->
  <view class="batch-toolbar" wx:if="{{isBatchMode}}">
    <view class="batch-info">
      <text class="batch-text">å·²é€‰æ‹© {{selectedNotes.length}} æ¡</text>
    </view>
    <view class="batch-actions">
      <button class="batch-btn restore-btn" bindtap="batchRestore">
        <text class="btn-icon">â™»ï¸</text>
        <text class="btn-text">æ¢å¤</text>
      </button>
      <button class="batch-btn delete-btn" bindtap="batchPermanentDelete">
        <text class="btn-icon">ğŸ”¥</text>
        <text class="btn-text">å½»åº•åˆ é™¤</text>
      </button>
    </view>
  </view>

  <!-- ç¬”è®°åˆ—è¡¨ -->
  <view class="notes-section">
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{trashedNotes.length === 0}}">
      <text class="empty-icon">ğŸ—‘ï¸</text>
      <text class="empty-text">å›æ”¶ç«™æ˜¯ç©ºçš„</text>
      <text class="empty-hint">å·²åˆ é™¤çš„ç¬”è®°ä¼šä¿ç•™ {{autoDeleteDays}} å¤©</text>
    </view>

    <!-- åˆ—è¡¨è§†å›¾ -->
    <view class="notes-list" wx:if="{{trashedNotes.length > 0 && viewMode === 'list'}}">
      <view class="note-card {{item.isSelected ? 'selected' : ''}}" 
            wx:for="{{trashedNotes}}" wx:key="id"
            bindtap="openNote" data-id="{{item.id}}">
        <!-- æ‰¹é‡é€‰æ‹©æ ‡è®° -->
        <view class="select-checkbox" wx:if="{{isBatchMode}}">
          <view class="checkbox {{item.isSelected ? 'checked' : ''}}">
            <text class="checkmark" wx:if="{{item.isSelected}}">âœ“</text>
          </view>
        </view>
        
        <view class="note-content">
          <view class="note-header">
            <text class="note-title">{{item.title}}</text>
            <view class="category-badge {{item.category}}">
              <text class="badge-text">{{getCategoryName(item.category)}}</text>
            </view>
          </view>
          
          <text class="note-preview">{{item.content}}</text>
          
          <view class="note-meta">
            <text class="meta-item">ğŸ“… {{item.createTime}}</text>
            <text class="meta-item">ğŸ’­ {{item.wordCount || 0}}å­—</text>
            <text class="meta-item delete-time">ğŸ—‘ï¸ {{item.deleteTime || item.createTime}}</text>
          </view>
          
          <view class="note-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <text class="tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">
              #{{tag}}
            </text>
          </view>
          
          <!-- åˆ é™¤è­¦å‘Š -->
          <view class="delete-warning" wx:if="{{getRemainingDays(item.deleteTime) <= 7}}">
            <text class="warning-text">â° è¿˜æœ‰ {{getRemainingDays(item.deleteTime)}} å¤©å°†è¢«æ°¸ä¹…åˆ é™¤</text>
          </view>
        </view>
        
        <view class="note-actions" wx:if="{{!isBatchMode}}">
          <view class="action-btn restore-action" catchtap="restoreNote" data-id="{{item.id}}">
            <text class="action-icon">â™»ï¸</text>
            <text class="action-text">æ¢å¤</text>
          </view>
          <view class="action-btn delete-action" catchtap="permanentDelete" data-id="{{item.id}}">
            <text class="action-icon">ğŸ”¥</text>
            <text class="action-text">åˆ é™¤</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç½‘æ ¼è§†å›¾ -->
    <view class="notes-grid" wx:if="{{trashedNotes.length > 0 && viewMode === 'grid'}}">
      <view class="note-grid-card {{item.isSelected ? 'selected' : ''}}" 
            wx:for="{{trashedNotes}}" wx:key="id"
            bindtap="openNote" data-id="{{item.id}}">
        <view class="select-checkbox" wx:if="{{isBatchMode}}">
          <view class="checkbox {{item.isSelected ? 'checked' : ''}}">
            <text class="checkmark" wx:if="{{item.isSelected}}">âœ“</text>
          </view>
        </view>
        
        <view class="category-badge-small {{item.category}}">
          <text class="badge-text-small">{{getCategoryName(item.category)}}</text>
        </view>
        
        <text class="grid-note-title">{{item.title}}</text>
        <text class="grid-note-preview">{{item.content}}</text>
        
        <view class="grid-note-footer">
          <text class="grid-meta">{{item.wordCount || 0}}å­—</text>
          <text class="grid-delete-icon">ğŸ—‘ï¸</text>
        </view>
        
        <view class="grid-warning" wx:if="{{getRemainingDays(item.deleteTime) <= 7}}">
          <text class="grid-warning-text">{{getRemainingDays(item.deleteTime)}}å¤©</text>
        </view>
      </view>
    </view>
  </view>
</view>

