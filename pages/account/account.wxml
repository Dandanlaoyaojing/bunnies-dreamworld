<!--pages/account/account.wxml-->
<view class="account-container">
  <!-- 导航栏 -->
  <view class="nav-bar">
    <view class="nav-content">
      <view class="nav-left" bindtap="goBack">
        <text class="nav-icon">←</text>
      </view>
      <text class="nav-title">账户管理</text>
      <view class="nav-right"></view>
    </view>
  </view>

  <!-- 用户信息卡片 -->
  <view class="profile-card">
    <view class="profile-header">
      <view class="avatar-container">
        <image class="avatar" src="{{userInfo.avatar || '/images/tabbar/my.png'}}" mode="aspectFill" />
        <view class="avatar-edit" bindtap="changeAvatar">
          <text class="edit-icon">📷</text>
        </view>
      </view>
      <view class="profile-info">
        <text class="username">{{userInfo.username || '未登录'}}</text>
        <text class="user-id">ID: {{userInfo.id || '000000'}}</text>
        <view class="user-status">
          <view class="status-dot {{userInfo.isOnline ? 'online' : 'offline'}}"></view>
          <text class="status-text">{{userInfo.isOnline ? '在线' : '离线'}}</text>
        </view>
      </view>
    </view>
    
    <view class="profile-stats">
      <view class="stat-item">
        <text class="stat-number">{{userInfo.noteCount || 0}}</text>
        <text class="stat-label">笔记</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{userInfo.followers || 0}}</text>
        <text class="stat-label">关注者</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{userInfo.following || 0}}</text>
        <text class="stat-label">关注中</text>
      </view>
    </view>
  </view>

  <!-- 设置卡片 -->
  <view class="settings-card">
    <view class="card-header">
      <text class="card-title">账户设置</text>
    </view>
    
    <view class="settings-list">
      <view class="setting-item" bindtap="editProfile">
        <view class="setting-icon">👤</view>
        <view class="setting-content">
          <text class="setting-title">编辑资料</text>
          <text class="setting-desc">修改个人信息</text>
        </view>
        <text class="setting-arrow">></text>
      </view>
      
      <view class="setting-item" bindtap="changePassword">
        <view class="setting-icon">🔒</view>
        <view class="setting-content">
          <text class="setting-title">修改密码</text>
          <text class="setting-desc">更改登录密码</text>
        </view>
        <text class="setting-arrow">></text>
      </view>
      
      <view class="setting-item" bindtap="privacySettings">
        <view class="setting-icon">🛡️</view>
        <view class="setting-content">
          <text class="setting-title">隐私设置</text>
          <text class="setting-desc">管理隐私选项</text>
        </view>
        <text class="setting-arrow">></text>
      </view>
      
      <view class="setting-item" bindtap="notificationSettings">
        <view class="setting-icon">🔔</view>
        <view class="setting-content">
          <text class="setting-title">通知设置</text>
          <text class="setting-desc">管理推送通知</text>
        </view>
        <text class="setting-arrow">></text>
      </view>
      
      <view class="setting-item" bindtap="myNotes">
        <view class="setting-icon">📝</view>
        <view class="setting-content">
          <text class="setting-title">我的笔记</text>
          <text class="setting-desc">管理所有笔记内容</text>
        </view>
        <text class="setting-arrow">></text>
      </view>
      
      <view class="setting-item" bindtap="saveToDanAccount">
        <view class="setting-icon">💾</view>
        <view class="setting-content">
          <text class="setting-title">保存到Dan账户</text>
          <text class="setting-desc">将所有笔记保存到Dan的账户</text>
        </view>
        <text class="setting-arrow">></text>
      </view>
      
      <view class="setting-item" bindtap="viewDanAccount">
        <view class="setting-icon">👤</view>
        <view class="setting-content">
          <text class="setting-title">查看Dan账户</text>
          <text class="setting-desc">查看Dan账户的详细信息</text>
        </view>
        <text class="setting-arrow">></text>
      </view>
      
      <view class="setting-item" bindtap="openDataRecovery">
        <view class="setting-icon">🔄</view>
        <view class="setting-content">
          <text class="setting-title">数据恢复工具</text>
          <text class="setting-desc">恢复丢失的笔记数据</text>
        </view>
        <text class="setting-arrow">></text>
      </view>
      
        <view class="setting-item" bindtap="openNetworkDiagnosis">
          <view class="setting-icon">🌐</view>
          <view class="setting-content">
            <text class="setting-title">网络诊断工具</text>
            <text class="setting-desc">诊断网络和AI服务问题</text>
          </view>
          <text class="setting-arrow">></text>
        </view>
        <view class="setting-item" bindtap="openAccountSave">
          <view class="setting-icon">💾</view>
          <view class="setting-content">
            <text class="setting-title">账户保存管理</text>
            <text class="setting-desc">管理笔记的账户保存功能</text>
          </view>
          <text class="setting-arrow">></text>
        </view>
    </view>
  </view>

  <!-- 存储管理 -->
  <view class="storage-card">
    <view class="card-header">
      <text class="card-title">存储管理</text>
    </view>
    
    <view class="storage-info">
      <view class="storage-item">
        <view class="storage-icon">📱</view>
        <view class="storage-content">
          <text class="storage-title">本地存储</text>
          <text class="storage-desc">已使用 {{storageInfo.localUsed || '0'}}MB / {{storageInfo.localTotal || '100'}}MB</text>
          <text class="storage-detail">小程序总存储空间</text>
        </view>
        <view class="storage-progress">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{storageInfo.localPercent || 0}}%"></view>
          </view>
          <text class="progress-text">{{storageInfo.localPercent || 0}}%</text>
        </view>
      </view>
      
      <view class="storage-item">
        <view class="storage-icon">📝</view>
        <view class="storage-content">
          <text class="storage-title">笔记数据</text>
          <text class="storage-desc">{{storageInfo.notesCount || '0'}} 条笔记</text>
          <text class="storage-detail">实际数据大小: {{storageInfo.dataSize || '0'}}KB</text>
        </view>
      </view>
      
      <view class="storage-item">
        <view class="storage-icon">👥</view>
        <view class="storage-content">
          <text class="storage-title">账户数据</text>
          <text class="storage-desc">{{storageInfo.accountsCount || '0'}} 个账户</text>
          <text class="storage-detail">{{storageInfo.tagsCount || '0'}} 个标签</text>
        </view>
      </view>
      
      <view class="storage-item">
        <view class="storage-icon">🔑</view>
        <view class="storage-content">
          <text class="storage-title">存储键值</text>
          <text class="storage-desc">{{storageInfo.keysCount || '0'}} 个存储项</text>
          <text class="storage-detail">前10项: {{storageInfo.keysList ? storageInfo.keysList.join(', ') : '无'}}</text>
        </view>
      </view>
      
      <view class="storage-warning" wx:if="{{storageInfo.localPercent > 80}}">
        <text class="warning-text">⚠️ 存储空间使用率过高，可能影响数据保存</text>
      </view>
    </view>
    
    <view class="storage-actions">
      <button class="storage-btn" bindtap="clearCache">清理缓存</button>
      <button class="storage-btn" bindtap="createBackup">创建备份</button>
      <button class="storage-btn recovery-btn" bindtap="recoverNotes">恢复笔记</button>
      <button class="storage-btn test-btn" bindtap="testAccountStorage">测试存储</button>
    </view>
    
    <view class="cloud-sync-section">
      <view class="cloud-header">
        <text class="cloud-title">☁️ 云存储同步</text>
        <text class="cloud-desc">突破10MB限制，数据永不丢失</text>
      </view>
      
      <view class="cloud-actions">
        <button class="cloud-btn primary" bindtap="testCloudConnection">测试云连接</button>
        <button class="cloud-btn secondary" bindtap="enableCloudSync">启用云同步</button>
        <button class="cloud-btn config-btn" bindtap="configureServer">配置服务器</button>
      </view>
      
      <view class="cloud-benefits">
        <view class="benefit-item">
          <text class="benefit-icon">💾</text>
          <text class="benefit-text">无限存储空间</text>
        </view>
        <view class="benefit-item">
          <text class="benefit-icon">🔄</text>
          <text class="benefit-text">自动同步备份</text>
        </view>
        <view class="benefit-item">
          <text class="benefit-icon">📱</text>
          <text class="benefit-text">多设备访问</text>
        </view>
        <view class="benefit-item">
          <text class="benefit-icon">🔒</text>
          <text class="benefit-text">数据安全加密</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 订阅管理 -->
  <view class="subscription-card">
    <view class="card-header">
      <text class="card-title">订阅管理</text>
    </view>
    
    <view class="subscription-info">
      <view class="subscription-item">
        <view class="subscription-icon">⭐</view>
        <view class="subscription-content">
          <text class="subscription-title">{{subscriptionInfo.plan || '免费版'}}</text>
          <text class="subscription-desc">{{subscriptionInfo.description || '基础功能'}}</text>
        </view>
        <view class="subscription-status">
          <text class="status-text {{subscriptionInfo.isActive ? 'active' : 'inactive'}}">
            {{subscriptionInfo.isActive ? '已激活' : '未激活'}}
          </text>
        </view>
      </view>
    </view>
    
    <view class="subscription-actions">
      <button class="subscription-btn" bindtap="upgradePlan">升级计划</button>
      <button class="subscription-btn secondary" bindtap="viewBilling">查看账单</button>
    </view>
  </view>

  <!-- 其他选项 -->
  <view class="other-card">
    <view class="card-header">
      <text class="card-title">其他</text>
    </view>
    
    <view class="other-list">
      <view class="other-item" bindtap="aboutApp">
        <view class="other-icon">ℹ️</view>
        <view class="other-content">
          <text class="other-title">关于应用</text>
          <text class="other-desc">版本 {{appInfo.version || '1.0.0'}}</text>
        </view>
        <text class="other-arrow">></text>
      </view>
      
      <view class="other-item" bindtap="helpCenter">
        <view class="other-icon">❓</view>
        <view class="other-content">
          <text class="other-title">帮助中心</text>
          <text class="other-desc">常见问题与支持</text>
        </view>
        <text class="other-arrow">></text>
      </view>
      
      <view class="other-item" bindtap="contactUs">
        <view class="other-icon">📞</view>
        <view class="other-content">
          <text class="other-title">联系我们</text>
          <text class="other-desc">反馈与建议</text>
        </view>
        <text class="other-arrow">></text>
      </view>
    </view>
  </view>

  <!-- 快速登录和退出登录 -->
  <view class="logout-section">
    <button class="quick-login-btn" bindtap="quickLogin">快速登录（测试）</button>
    <button class="logout-btn" bindtap="logout">退出登录</button>
  </view>
</view>
