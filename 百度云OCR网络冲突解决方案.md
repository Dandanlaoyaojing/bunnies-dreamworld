# 百度云OCR网络冲突解决方案

## 🔍 问题分析

根据诊断结果，您的百度云OCR在后端服务器启动后无法正常使用，主要原因是：

### 1. **微信小程序域名白名单限制**
- 微信小程序对网络请求有严格的域名白名单限制
- 需要在微信公众平台后台配置服务器域名
- 当前配置的域名：
  - 后端服务器：`http://10.10.12.20:3000`
  - 百度云API：`https://aip.baidubce.com`

### 2. **网络请求并发限制**
- 微信小程序可能有并发请求限制
- 后端服务器启动后可能占用网络资源
- 网络超时设置：10秒

### 3. **可能的代理或防火墙问题**
- 后端服务器可能设置了代理
- 防火墙可能阻止外部API请求

## 🛠️ 解决方案

### 方案一：配置微信小程序域名白名单（推荐）

1. **登录微信公众平台**
   - 访问：https://mp.weixin.qq.com
   - 进入您的小程序管理后台

2. **配置服务器域名**
   - 进入：开发 → 开发管理 → 开发设置 → 服务器域名
   - 添加以下域名到request合法域名：
     ```
     https://aip.baidubce.com
     https://api.deepseek.com
     ```

3. **配置uploadFile合法域名**（如果需要）
   ```
   https://aip.baidubce.com
   ```

### 方案二：优化网络请求配置

1. **增加网络超时时间**
   ```json
   // app.json
   "networkTimeout": {
     "request": 30000,  // 增加到30秒
     "downloadFile": 30000
   }
   ```

2. **添加重试机制**
   - 在OCR请求失败时自动重试
   - 设置合理的重试间隔

### 方案三：检查后端服务器配置

1. **检查代理设置**
   - 确保后端服务器没有设置全局代理
   - 检查是否有网络代理影响外部请求

2. **检查防火墙设置**
   - 确保防火墙允许HTTPS请求
   - 检查是否有端口限制

### 方案四：使用备用OCR方案

如果百度云OCR持续有问题，可以：

1. **使用微信小程序原生OCR**（如果可用）
2. **集成其他OCR服务**（如腾讯云OCR）
3. **实现本地OCR**（使用小程序插件）

## 🔧 立即执行的修复步骤

### 1. 更新app.json配置
```json
{
  "networkTimeout": {
    "request": 30000,
    "downloadFile": 30000
  }
}
```

### 2. 添加错误重试机制
在`utils/aiService.js`中的OCR方法中添加重试逻辑。

### 3. 配置域名白名单
在微信公众平台后台添加百度云API域名。

## 📋 测试步骤

1. **测试百度云OCR**
   - 关闭后端服务器
   - 测试图片识别功能
   - 记录结果

2. **测试后端服务器**
   - 启动后端服务器
   - 测试图片识别功能
   - 对比结果

3. **测试网络连接**
   - 检查是否能访问百度云API
   - 检查网络延迟和稳定性

## 🚨 紧急解决方案

如果问题紧急，可以：

1. **临时禁用后端服务器**
   - 在需要OCR时关闭后端服务器
   - 使用OCR后再启动后端服务器

2. **使用本地OCR备用方案**
   - 实现简单的本地文字识别
   - 作为百度云OCR的备用方案

## 📞 技术支持

如果问题仍然存在，请提供：
1. 微信小程序后台的域名白名单配置截图
2. 网络请求的详细错误日志
3. 后端服务器的网络配置信息

---

**注意**：微信小程序的域名白名单配置是解决此问题的关键步骤，请优先执行方案一。
